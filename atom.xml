<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://ihopefulchina.github.io</id>
    <title>ihopeful Blog</title>
    <updated>2025-08-27T08:46:02.504Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://ihopefulchina.github.io"/>
    <link rel="self" href="https://ihopefulchina.github.io/atom.xml"/>
    <subtitle>ğŸ§‘â€ğŸ’»åˆ‡å›¾ä»”</subtitle>
    <logo>https://ihopefulchina.github.io/images/avatar.png</logo>
    <icon>https://ihopefulchina.github.io/favicon.ico</icon>
    <rights>All rights reserved 2025, ihopeful Blog</rights>
    <entry>
        <title type="html"><![CDATA[uniapp-template ]]></title>
        <id>https://ihopefulchina.github.io/uniapp_template /</id>
        <link href="https://ihopefulchina.github.io/uniapp_template /">
        </link>
        <updated>2025-08-15T07:45:50.000Z</updated>
        <summary type="html"><![CDATA[<p>ä¸€ä¸ªåŸºäº Vue 3 + TypeScript + Pinia çš„ UniApp è·¨å¹³å°å¼€å‘æ¨¡æ¿é¡¹ç›®ï¼Œé›†æˆäº†å®Œæ•´çš„å¼€å‘å·¥å…·é“¾å’Œç»„ä»¶åº“ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>ä¸€ä¸ªåŸºäº Vue 3 + TypeScript + Pinia çš„ UniApp è·¨å¹³å°å¼€å‘æ¨¡æ¿é¡¹ç›®ï¼Œé›†æˆäº†å®Œæ•´çš„å¼€å‘å·¥å…·é“¾å’Œç»„ä»¶åº“ã€‚</p>
<!-- more -->
<h2 id="é¡¹ç›®ç‰¹æ€§">é¡¹ç›®ç‰¹æ€§</h2>
<ul>
<li>ğŸš€ <strong>Vue 3</strong> - ä½¿ç”¨æœ€æ–°çš„ Vue 3 Composition API</li>
<li>ğŸ“± <strong>è·¨å¹³å°</strong> - æ”¯æŒå¾®ä¿¡å°ç¨‹åºã€H5ã€App ç­‰å¤šä¸ªå¹³å°</li>
<li>ğŸ”§ <strong>TypeScript</strong> - å®Œæ•´çš„ TypeScript æ”¯æŒ</li>
<li>ğŸ“¦ <strong>Pinia</strong> - ç°ä»£åŒ–çš„çŠ¶æ€ç®¡ç†</li>
<li>ğŸ¨ <strong>Sass/SCSS</strong> - CSS é¢„å¤„ç†å™¨æ”¯æŒ</li>
<li>ğŸ“¡ <strong>API ç®¡ç†</strong> - é›†æˆ Swagger API æ¨¡æ¿ç”Ÿæˆ</li>
<li>ğŸ” <strong>ESLint + Prettier</strong> - ä»£ç è´¨é‡æ£€æŸ¥å’Œæ ¼å¼åŒ–</li>
<li>ğŸ“ <strong>Monorepo</strong> - ä½¿ç”¨ pnpm workspace ç®¡ç†å¤šåŒ…é¡¹ç›®</li>
<li>ğŸ¯ <strong>Wot Design Uni</strong> - é›†æˆå®Œæ•´çš„UIç»„ä»¶åº“</li>
<li>ğŸ› ï¸ <strong>å¼€å‘å·¥å…·</strong> - è‡ªåŠ¨è·¯ç”±ç”Ÿæˆã€é¡µé¢ç›‘å¬ç­‰æ’ä»¶</li>
<li>ğŸ” <strong>æƒé™ç®¡ç†</strong> - å®Œæ•´çš„ç™»å½•æˆæƒå’Œtokenç®¡ç†</li>
<li>ğŸ“¤ <strong>æ–‡ä»¶ä¸Šä¼ </strong> - é›†æˆé˜¿é‡Œäº‘OSSæ–‡ä»¶ä¸Šä¼ åŠŸèƒ½</li>
<li>ğŸ“Š <strong>çŠ¶æ€ç®¡ç†</strong> - ä¸°å¯Œçš„Vue 3 Hookså’ŒçŠ¶æ€ç®¡ç†å·¥å…·</li>
</ul>
<h2 id="é¡¹ç›®ç»“æ„">é¡¹ç›®ç»“æ„</h2>
<pre><code>uniapp-template/
â”œâ”€â”€ components/                    # å…¬å…±ç»„ä»¶å’Œå·¥å…·
â”‚   â”œâ”€â”€ eslint-config/            # ESLint é…ç½®åŒ…
â”‚   â””â”€â”€ swagger-api-templates/    # API æ¨¡æ¿ç”Ÿæˆå·¥å…·
â”œâ”€â”€ packages/
â”‚   â””â”€â”€ uni-template/             # ä¸»è¦çš„ UniApp é¡¹ç›®
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ pages/            # é¡µé¢æ–‡ä»¶
â”‚       â”‚   â”‚   â”œâ”€â”€ common/       # å…¬å…±é¡µé¢
â”‚       â”‚   â”‚   â”œâ”€â”€ tabbar/       # åº•éƒ¨å¯¼èˆªé¡µé¢
â”‚       â”‚   â”‚   â””â”€â”€ template/     # æ¨¡æ¿é¡µé¢
â”‚       â”‚   â”œâ”€â”€ components/       # ç»„ä»¶
â”‚       â”‚   â”‚   â”œâ”€â”€ common/       # å…¬å…±ç»„ä»¶
â”‚       â”‚   â”‚   â”œâ”€â”€ help/         # å¸®åŠ©ç»„ä»¶
â”‚       â”‚   â”‚   â””â”€â”€ request/      # è¯·æ±‚ç›¸å…³ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ layout/           # å¸ƒå±€ç»„ä»¶
â”‚       â”‚   â”‚   â”œâ”€â”€ navigation/   # å¯¼èˆªæ ç»„ä»¶
â”‚       â”‚   â”‚   â””â”€â”€ pageContainer/# é¡µé¢å®¹å™¨ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ store/            # Pinia çŠ¶æ€ç®¡ç†
â”‚       â”‚   â”œâ”€â”€ request/          # API è¯·æ±‚å°è£…
â”‚       â”‚   â”œâ”€â”€ utils/            # å·¥å…·å‡½æ•°
â”‚       â”‚   â”œâ”€â”€ hooks/            # Vue 3 Hooks
â”‚       â”‚   â”œâ”€â”€ enums/            # æšä¸¾å®šä¹‰
â”‚       â”‚   â”œâ”€â”€ types/            # ç±»å‹å®šä¹‰
â”‚       â”‚   â”œâ”€â”€ static/           # é™æ€èµ„æº
â”‚       â”‚   â””â”€â”€ uni_modules/      # UniApp æ¨¡å—
â”‚       â”‚       â””â”€â”€ wot-design-uni/ # Wot Design Uni ç»„ä»¶åº“
â”‚       â”œâ”€â”€ plugins/              # è‡ªå®šä¹‰æ’ä»¶
â”‚       â”œâ”€â”€ scripts/              # æ„å»ºè„šæœ¬
â”‚       â””â”€â”€ dist/                 # æ„å»ºè¾“å‡º
â”œâ”€â”€ package.json                  # æ ¹åŒ…é…ç½®
â”œâ”€â”€ pnpm-workspace.yaml          # pnpm å·¥ä½œåŒºé…ç½®
â””â”€â”€ README.md                     # é¡¹ç›®è¯´æ˜æ–‡æ¡£
</code></pre>
<h2 id="å¿«é€Ÿå¼€å§‹">å¿«é€Ÿå¼€å§‹</h2>
<h3 id="ç¯å¢ƒè¦æ±‚">ç¯å¢ƒè¦æ±‚</h3>
<ul>
<li>Node.js &gt;= 18</li>
<li>pnpm &gt;= 8</li>
</ul>
<h3 id="å®‰è£…ä¾èµ–">å®‰è£…ä¾èµ–</h3>
<pre><code class="language-bash">pnpm install
</code></pre>
<h3 id="å¼€å‘å‘½ä»¤">å¼€å‘å‘½ä»¤</h3>
<pre><code class="language-bash"># è¿›å…¥é¡¹ç›®ç›®å½•
cd packages/uni-template

# å¾®ä¿¡å°ç¨‹åºå¼€å‘
pnpm dev

# H5 å¼€å‘
pnpm dev:h5

# App å¼€å‘
pnpm dev:app

# å…¶ä»–å¹³å°
pnpm dev:mp-alipay    # æ”¯ä»˜å®å°ç¨‹åº
pnpm dev:mp-baidu     # ç™¾åº¦å°ç¨‹åº
pnpm dev:mp-qq        # QQ å°ç¨‹åº
pnpm dev:mp-toutiao   # å­—èŠ‚è·³åŠ¨å°ç¨‹åº
pnpm dev:mp-kuaishou  # å¿«æ‰‹å°ç¨‹åº
pnpm dev:mp-jd        # äº¬ä¸œå°ç¨‹åº
pnpm dev:mp-lark      # é£ä¹¦å°ç¨‹åº
</code></pre>
<h3 id="æ„å»ºå‘½ä»¤">æ„å»ºå‘½ä»¤</h3>
<pre><code class="language-bash"># è¿›å…¥é¡¹ç›®ç›®å½•
cd packages/uni-template

# å¾®ä¿¡å°ç¨‹åºæ„å»º
pnpm build

# H5 æ„å»º
pnpm build:h5

# App æ„å»º
pnpm build:app
</code></pre>
<h3 id="api-ç”Ÿæˆ">API ç”Ÿæˆ</h3>
<pre><code class="language-bash"># è¿›å…¥é¡¹ç›®ç›®å½•
cd packages/uni-template

# æ ¹æ®apifox/swagger æ–‡æ¡£å¯¼å‡ºæ¥å£jsonåœ°å€ï¼Œä¿®æ”¹é¡¹ç›®é…ç½®æ–‡ä»¶ï¼šswaggerApi.config.js
projects: [{ name: '', url: 'http://127.0.0.1:4523/export/openapi/2?version=3.0' }]

# æ ¹æ® apifox æ–‡æ¡£ç”Ÿæˆ API æ¥å£
pnpm api
</code></pre>
<h2 id="æ ¸å¿ƒç»„ä»¶">æ ¸å¿ƒç»„ä»¶</h2>
<h3 id="å¸ƒå±€ç»„ä»¶">å¸ƒå±€ç»„ä»¶</h3>
<ul>
<li><strong>Navigation</strong> - è‡ªå®šä¹‰å¯¼èˆªæ ç»„ä»¶ï¼Œæ”¯æŒçŠ¶æ€æ é«˜åº¦é€‚é…</li>
<li><strong>PageContainer</strong> - é¡µé¢å®¹å™¨ç»„ä»¶ï¼Œç»Ÿä¸€é¡µé¢å¸ƒå±€</li>
</ul>
<h3 id="å…¬å…±ç»„ä»¶">å…¬å…±ç»„ä»¶</h3>
<ul>
<li><strong>ImageUpload</strong> - å›¾ç‰‡ä¸Šä¼ ç»„ä»¶ï¼Œæ”¯æŒå¤šå›¾ä¸Šä¼ ã€é¢„è§ˆã€åˆ é™¤</li>
<li><strong>Poster</strong> - æµ·æŠ¥ç”Ÿæˆç»„ä»¶ï¼Œæ”¯æŒCanvasç»˜åˆ¶å’Œå›¾ç‰‡åˆæˆ</li>
<li><strong>PullToRefresh</strong> - ä¸‹æ‹‰åˆ·æ–°ç»„ä»¶ï¼Œæ”¯æŒè‡ªå®šä¹‰åˆ·æ–°é€»è¾‘</li>
<li><strong>RefreshList</strong> - åˆ—è¡¨åˆ·æ–°ç»„ä»¶ï¼Œé›†æˆä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½</li>
<li><strong>RichText</strong> - å¯Œæ–‡æœ¬ç»„ä»¶ï¼Œæ”¯æŒHTMLå†…å®¹æ¸²æŸ“</li>
<li><strong>Ellipsis</strong> - æ–‡æœ¬çœç•¥ç»„ä»¶ï¼Œæ”¯æŒå¤šè¡Œæ–‡æœ¬æˆªæ–­</li>
</ul>
<h3 id="ui-ç»„ä»¶åº“">UI ç»„ä»¶åº“</h3>
<p>é¡¹ç›®é›†æˆäº† <strong>Wot Design Uni</strong> ç»„ä»¶åº“ï¼ŒåŒ…å«ï¼š</p>
<ul>
<li>åŸºç¡€ç»„ä»¶ï¼šButtonã€Cellã€Iconã€Inputã€Gapã€Dividerç­‰</li>
<li>è¡¨å•ç»„ä»¶ï¼šFormã€Checkboxã€Radioã€Switchã€InputNumberç­‰</li>
<li>åé¦ˆç»„ä»¶ï¼šToastã€Dialogã€Loadingã€Notifyã€MessageBoxç­‰</li>
<li>å±•ç¤ºç»„ä»¶ï¼šCardã€Tagã€Badgeã€Progressã€Circleç­‰</li>
<li>å¯¼èˆªç»„ä»¶ï¼šTabsã€Tabbarã€Navbarã€Sidebarã€IndexBarç­‰</li>
<li>æ•°æ®å½•å…¥ï¼šDatetimePickerã€Calendarã€ColPickerã€PasswordInputç­‰</li>
</ul>
<h3 id="æ ·å¼æ–‡ä»¶ç»„ç»‡">æ ·å¼æ–‡ä»¶ç»„ç»‡</h3>
<pre><code>src/
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ index.scss          # å…¨å±€æ ·å¼å…¥å£
â”œâ”€â”€ components/
â”‚   â””â”€â”€ */index.scss        # ç»„ä»¶æ ·å¼æ–‡ä»¶
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ */index.scss        # é¡µé¢æ ·å¼æ–‡ä»¶
â””â”€â”€ layout/
    â””â”€â”€ */index.scss        # å¸ƒå±€æ ·å¼æ–‡ä»¶
</code></pre>
<h3 id="ä¸»é¢˜å˜é‡">ä¸»é¢˜å˜é‡</h3>
<p>ä½¿ç”¨ CSS å˜é‡å®šä¹‰ä¸»é¢˜è‰²å½©å’Œå°ºå¯¸ï¼š</p>
<pre><code class="language-scss">:root {
  --wot-color-theme: #517cf0;
  --wot-color-success: #34d19d;
  --wot-color-warning: #f0883a;
  --wot-color-danger: #fa4350;
}
</code></pre>
<h2 id="å¼€å‘å·¥å…·">å¼€å‘å·¥å…·</h2>
<h3 id="æ’ä»¶å·¥å…·">æ’ä»¶å·¥å…·</h3>
<p>é¡¹ç›®åŒ…å«ä¸¤ä¸ªè‡ªå®šä¹‰æ’ä»¶ï¼Œç”¨äºè‡ªåŠ¨åŒ–å¼€å‘æµç¨‹ï¼š</p>
<h4 id="è·¯ç”±ç”Ÿæˆæ’ä»¶-getroutemjs">è·¯ç”±ç”Ÿæˆæ’ä»¶ (<code>getRoute.mjs</code>)</h4>
<pre><code class="language-bash"># è¿›å…¥é¡¹ç›®ç›®å½•
cd packages/uni-template

# æ‰‹åŠ¨ç”Ÿæˆè·¯ç”±æ–‡ä»¶
pnpm route
</code></pre>
<p><strong>åŠŸèƒ½è¯´æ˜ï¼š</strong></p>
<ul>
<li>è‡ªåŠ¨è¯»å– <code>src/pages.json</code> é…ç½®</li>
<li>ç”Ÿæˆ <code>src/routes.ts</code> è·¯ç”±æ˜ å°„æ–‡ä»¶</li>
<li>ç”Ÿæˆ <code>src/RouteParams.d.ts</code> è·¯ç”±å‚æ•°ç±»å‹å®šä¹‰</li>
<li>æ”¯æŒä¸»åŒ…é¡µé¢å’Œåˆ†åŒ…é¡µé¢</li>
<li>è‡ªåŠ¨æå–é¡µé¢æ ‡é¢˜å’Œè·¯å¾„ä¿¡æ¯</li>
<li>ç”Ÿæˆ tabbar é¡µé¢é…ç½®</li>
</ul>
<p><strong>ç”Ÿæˆçš„æ–‡ä»¶ï¼š</strong></p>
<ul>
<li><code>routes.ts</code> - åŒ…å« <code>routeNames</code> å¯¹è±¡å’Œç±»å‹å®šä¹‰</li>
<li><code>RouteParams.d.ts</code> - è·¯ç”±å‚æ•°çš„ TypeScript ç±»å‹å®šä¹‰</li>
</ul>
<h4 id="é¡µé¢ç›‘å¬æ’ä»¶-watch-pagesmjs">é¡µé¢ç›‘å¬æ’ä»¶ (<code>watch-pages.mjs</code>)</h4>
<pre><code class="language-bash"># å¼€å‘æ¨¡å¼ä¸‹è‡ªåŠ¨è¿è¡Œï¼ˆåŒ…å«åœ¨ dev å‘½ä»¤ä¸­ï¼‰
pnpm dev
</code></pre>
<p><strong>åŠŸèƒ½è¯´æ˜ï¼š</strong></p>
<ul>
<li>ç›‘å¬ <code>src/pages.json</code> æ–‡ä»¶å˜åŒ–</li>
<li>æ–‡ä»¶å˜æ›´æ—¶è‡ªåŠ¨é‡æ–°ç”Ÿæˆè·¯ç”±æ–‡ä»¶</li>
<li>å¼€å‘æ¨¡å¼ä¸‹æä¾›å®æ—¶è·¯ç”±æ›´æ–°</li>
<li>é¿å…æ‰‹åŠ¨ç»´æŠ¤è·¯ç”±æ˜ å°„çš„ç¹çå·¥ä½œ</li>
</ul>
<p><strong>å·¥ä½œæµç¨‹ï¼š</strong></p>
<ol>
<li>å¯åŠ¨æ—¶æ‰§è¡Œä¸€æ¬¡è·¯ç”±ç”Ÿæˆ</li>
<li>æŒç»­ç›‘å¬ <code>pages.json</code> æ–‡ä»¶</li>
<li>æ£€æµ‹åˆ°å˜æ›´æ—¶è‡ªåŠ¨é‡æ–°ç”Ÿæˆè·¯ç”±æ–‡ä»¶</li>
<li>æ§åˆ¶å°è¾“å‡ºç”ŸæˆçŠ¶æ€å’Œç»“æœ</li>
</ol>
<h2 id="çŠ¶æ€ç®¡ç†">çŠ¶æ€ç®¡ç†</h2>
<h3 id="pinia-store">Pinia Store</h3>
<p>ä½¿ç”¨ Pinia è¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼Œstore æ–‡ä»¶æ”¾åœ¨ <code>src/store/</code> ç›®å½•ä¸‹ï¼š</p>
<pre><code class="language-typescript">// src/store/common/useGlobalStore.ts
export const useGlobalStore = defineStore('globalStore', () =&gt; {
  const userInfo = ref&lt;MemberDto&gt;()

  const getUserInfo = async () =&gt; {
    const { data, code } = await api.get['/api/member/v1/member/getUserInfo']()
    data &amp;&amp; setUserInfo(data)
    return { data, code }
  }

  return { userInfo, getUserInfo }
})
</code></pre>
<p><strong>ä¸»è¦Storeï¼š</strong></p>
<ul>
<li><code>useGlobalStore</code> - å…¨å±€çŠ¶æ€ç®¡ç†ï¼Œç”¨æˆ·ä¿¡æ¯ã€ç™»å½•çŠ¶æ€ç­‰</li>
<li><code>useSystemInfo</code> - ç³»ç»Ÿä¿¡æ¯ç®¡ç†ï¼Œè®¾å¤‡ä¿¡æ¯ã€å±å¹•å°ºå¯¸ç­‰</li>
<li><code>useGetAccountInfo</code> - å°ç¨‹åºç¯å¢ƒä¿¡æ¯ç®¡ç†</li>
</ul>
<h3 id="ç»„åˆå¼å‡½æ•°-hooks">ç»„åˆå¼å‡½æ•° (Hooks)</h3>
<p>é¡¹ç›®æä¾›äº†å¤šä¸ªå®ç”¨çš„ç»„åˆå¼å‡½æ•°ï¼š</p>
<h4 id="çŠ¶æ€ç®¡ç†ç±»">çŠ¶æ€ç®¡ç†ç±»</h4>
<ul>
<li><code>useBoolean</code> - å¸ƒå°”å€¼çŠ¶æ€ç®¡ç†ï¼Œæ”¯æŒsetTrue/setFalse/toggleç­‰æ“ä½œ</li>
<li><code>useToggle</code> - åˆ‡æ¢çŠ¶æ€ç®¡ç†ï¼Œæ”¯æŒä¸¤ä¸ªå€¼ä¹‹é—´çš„åˆ‡æ¢</li>
<li><code>useState</code> - å—æ§/éå—æ§çŠ¶æ€ç®¡ç†ï¼Œç±»ä¼¼Reactçš„useState</li>
<li><code>useUpdate</code> - å¼ºåˆ¶æ›´æ–°ç»„ä»¶</li>
</ul>
<h4 id="è¡¨å•å’Œæ•°æ®å¤„ç†">è¡¨å•å’Œæ•°æ®å¤„ç†</h4>
<ul>
<li><code>useFormService</code> - è¡¨å•æœåŠ¡å°è£…ï¼Œæ”¯æŒè¡¨å•æ•°æ®ç®¡ç†å’Œé‡ç½®</li>
<li><code>useMutate</code> - æ•°æ®è·å–å’ŒçŠ¶æ€ç®¡ç†ï¼Œæ”¯æŒæ•°æ®æ ¼å¼åŒ–</li>
<li><code>usePullToRefresh</code> - ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½æ›´å¤š</li>
<li><code>useModify</code> - é¡µé¢æ•°æ®ä¿®æ”¹å’Œæ›´æ–°</li>
</ul>
<h4 id="é¡µé¢å’Œå¯¼èˆª">é¡µé¢å’Œå¯¼èˆª</h4>
<ul>
<li><code>useNavigation</code> - é¡µé¢å¯¼èˆªç®¡ç†ï¼Œæ”¯æŒå„ç§è·³è½¬æ–¹å¼</li>
<li><code>useParams</code> - é¡µé¢å‚æ•°è·å–ï¼Œæ”¯æŒåœºæ™¯å€¼è§£æ</li>
<li><code>useGetParams</code> - ç»„ä»¶ä¸­è·å–é¡µé¢å‚æ•°</li>
<li><code>useScroll</code> - æ»šåŠ¨ç›‘å¬å’Œå¸é¡¶æ•ˆæœ</li>
</ul>
<h4 id="å·¥å…·ç±»">å·¥å…·ç±»</h4>
<ul>
<li><code>useLockFn</code> - å‡½æ•°é˜²æŠ–å’Œé”å®šï¼Œé˜²æ­¢é‡å¤è°ƒç”¨</li>
<li><code>useNetworkStatus</code> - ç½‘ç»œçŠ¶æ€ç›‘å¬</li>
<li><code>useUpdateEffect</code> - å¿½ç•¥é¦–æ¬¡æ‰§è¡Œçš„effect</li>
</ul>
<h2 id="api-è¯·æ±‚">API è¯·æ±‚</h2>
<p>é¡¹ç›®ä½¿ç”¨è‡ªå®šä¹‰å°è£…çš„è¯·æ±‚åº“ï¼Œæ”¯æŒæ ¹æ®swaggeræ–‡æ¡£ç”Ÿæˆtsã€è‡ªåŠ¨tokenç®¡ç†å’Œé™é»˜æˆæƒï¼Œä»¥åŠç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œå“åº”æ‹¦æˆªã€‚</p>
<h3 id="è¯·æ±‚å°è£…">è¯·æ±‚å°è£…</h3>
<p>ä½¿ç”¨è‡ªå®šä¹‰å°è£…çš„è¯·æ±‚åº“ï¼Œé…ç½®æ–‡ä»¶åœ¨ <code>src/request/</code> ç›®å½•ä¸‹ï¼š</p>
<pre><code class="language-typescript">// ä½¿ç”¨è¯·æ±‚
const data = await api.get['/api/member/v1/activity/activity']()
const result = await api.post['/api/auth/login']({ username, password })
</code></pre>
<p><strong>ç‰¹æ€§ï¼š</strong></p>
<ul>
<li>æ ¹æ®swaggeræ–‡æ¡£ç”Ÿæˆts</li>
<li>è‡ªåŠ¨tokenç®¡ç†å’Œé™é»˜æˆæƒ</li>
<li>ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œå“åº”æ‹¦æˆª</li>
<li>æ”¯æŒè¯·æ±‚å’Œå“åº”æ‹¦æˆªå™¨</li>
<li>è‡ªåŠ¨å¤„ç†FormDataå’ŒæŸ¥è¯¢å‚æ•°</li>
</ul>
<h3 id="è¯·æ±‚å®ä¾‹">è¯·æ±‚å®ä¾‹</h3>
<pre><code class="language-typescript">// src/request/instance.ts
const instance = Request.create({ baseUrl: apiUrl })

// è¯·æ±‚æ‹¦æˆªå™¨ - è‡ªåŠ¨æ·»åŠ token
instance.requestInterceptors.use(async (config) =&gt; {
  let token = getAuthorization()
  if (!token &amp;&amp; silentAuthorization) {
    const { data } = await getToken(silentAuthorizationUrl)
    token = data
    setAuthorization(token)
  }
  config.headers = { ...config.headers, Authorization: token }
  return config
})

// å“åº”æ‹¦æˆªå™¨ - ç»Ÿä¸€é”™è¯¯å¤„ç†
instance.responseInterceptors.use((res) =&gt; {
  if ([403, 40003, 401].indexOf(res.data.code) !== -1) {
    // tokenè¿‡æœŸå¤„ç†
    removeAuthorization()
    loginUrl &amp;&amp; uni.navigateTo({ url: loginUrl })
    throw new Error()
  }
  return res.data
})
</code></pre>
<h2 id="å·¥å…·å‡½æ•°">å·¥å…·å‡½æ•°</h2>
<h3 id="æ–‡ä»¶å¤„ç†">æ–‡ä»¶å¤„ç†</h3>
<ul>
<li><strong>é˜¿é‡Œäº‘OSSä¸Šä¼ </strong> - æ”¯æŒå›¾ç‰‡ã€æ–‡ä»¶ä¸Šä¼ åˆ°é˜¿é‡Œäº‘OSS</li>
<li><strong>å›¾ç‰‡å¤„ç†</strong> - å›¾ç‰‡å‹ç¼©ã€è£å‰ªã€æ ¼å¼è½¬æ¢ç­‰</li>
<li><strong>æ–‡ä»¶ç±»å‹æ£€æµ‹</strong> - è‡ªåŠ¨è¯†åˆ«å›¾ç‰‡ã€è§†é¢‘ã€éŸ³é¢‘ã€PDFç­‰æ–‡ä»¶ç±»å‹</li>
</ul>
<h3 id="æ•°æ®å¤„ç†">æ•°æ®å¤„ç†</h3>
<ul>
<li><strong>é«˜ç²¾åº¦è®¡ç®—</strong> - è§£å†³JavaScriptæµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜</li>
<li><strong>æ•°æ®æ ¼å¼åŒ–</strong> - é‡‘é¢æ ¼å¼åŒ–ã€ç”µè¯å·ç è„±æ•ç­‰</li>
<li><strong>æ•°ç»„æ“ä½œ</strong> - å»é‡ã€æ’åºã€è½¬æ¢ç­‰å·¥å…·å‡½æ•°</li>
</ul>
<h3 id="å¹³å°é€‚é…">å¹³å°é€‚é…</h3>
<ul>
<li><strong>è®¾å¤‡ä¿¡æ¯</strong> - è·å–è®¾å¤‡å‹å·ã€å±å¹•å°ºå¯¸ã€çŠ¶æ€æ é«˜åº¦ç­‰</li>
<li><strong>å¹³å°æ£€æµ‹</strong> - è‡ªåŠ¨è¯†åˆ«å½“å‰è¿è¡Œå¹³å°</li>
<li><strong>ç½‘ç»œçŠ¶æ€</strong> - ç›‘å¬ç½‘ç»œçŠ¶æ€å˜åŒ–</li>
</ul>
<h2 id="æ”¯æŒå¹³å°">æ”¯æŒå¹³å°</h2>
<ul>
<li>âœ… å¾®ä¿¡å°ç¨‹åº (MP-WEIXIN)</li>
<li>âœ… H5 (H5)</li>
<li>âœ… App (Android/iOS)</li>
<li>âœ… æ”¯ä»˜å®å°ç¨‹åº (MP-ALIPAY)</li>
<li>âœ… ç™¾åº¦å°ç¨‹åº (MP-BAIDU)</li>
<li>âœ… QQ å°ç¨‹åº (MP-QQ)</li>
<li>âœ… å­—èŠ‚è·³åŠ¨å°ç¨‹åº (MP-TOUTIAO)</li>
<li>âœ… å¿«æ‰‹å°ç¨‹åº (MP-KUAISHOU)</li>
<li>âœ… äº¬ä¸œå°ç¨‹åº (MP-JD)</li>
<li>âœ… é£ä¹¦å°ç¨‹åº (MP-LARK)</li>
<li>âœ… å¿«åº”ç”¨ (QUICKAPP-WEBVIEW)</li>
</ul>
<h2 id="æŠ€æœ¯æ ˆ">æŠ€æœ¯æ ˆ</h2>
<ul>
<li><strong>æ¡†æ¶</strong>: UniApp 3.x + Vue 3.5.11</li>
<li><strong>å‰ç«¯</strong>: Vue 3 + TypeScript 5.9.2</li>
<li><strong>çŠ¶æ€ç®¡ç†</strong>: Pinia 2.3.1</li>
<li><strong>æ ·å¼</strong>: Sass 1.66.1</li>
<li><strong>æ„å»ºå·¥å…·</strong>: Vite 5.2.11</li>
<li><strong>ä»£ç è§„èŒƒ</strong>: ESLint 8.57.1 + Prettier 3.6.2</li>
<li><strong>åŒ…ç®¡ç†</strong>: pnpm workspace</li>
<li><strong>API å·¥å…·</strong>: è‡ªå®šä¹‰è¯·æ±‚å°è£… + Swagger æ¨¡æ¿ç”Ÿæˆ</li>
<li><strong>UI ç»„ä»¶</strong>: Wot Design Uni</li>
<li><strong>å¼€å‘å·¥å…·</strong>: è‡ªåŠ¨è·¯ç”±ç”Ÿæˆã€é¡µé¢ç›‘å¬ç­‰æ’ä»¶</li>
<li><strong>å·¥å…·åº“</strong>: dayjs 1.11.13 (æ—¥æœŸå¤„ç†)</li>
</ul>
<h2 id="å¼€å‘æŒ‡å—">å¼€å‘æŒ‡å—</h2>
<h3 id="é¡µé¢è·¯ç”±">é¡µé¢è·¯ç”±</h3>
<p>é¡µé¢è·¯ç”±é…ç½®åœ¨ <code>src/pages.json</code> ä¸­ï¼Œæ”¯æŒè‡ªåŠ¨è·¯ç”±ç”Ÿæˆã€‚</p>
<h3 id="ç»„ä»¶å¼€å‘">ç»„ä»¶å¼€å‘</h3>
<p>å…¬å…±ç»„ä»¶æ”¾åœ¨ <code>src/components/</code> ç›®å½•ä¸‹ï¼Œæ”¯æŒ TypeScript ç±»å‹å®šä¹‰ï¼š</p>
<pre><code class="language-vue">&lt;template&gt;
  &lt;view class=&quot;custom-component&quot;&gt;
    &lt;slot /&gt;
  &lt;/view&gt;
&lt;/template&gt;

&lt;script setup lang=&quot;ts&quot;&gt;
interface Props {
  title?: string
}

defineProps&lt;Props&gt;()
&lt;/script&gt;
</code></pre>
<h3 id="ç±»å‹å®šä¹‰">ç±»å‹å®šä¹‰</h3>
<p>é¡¹ç›®åŒ…å«å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰ï¼š</p>
<ul>
<li><code>src/types/</code> - å…¨å±€ç±»å‹å®šä¹‰</li>
<li><code>src/enums/</code> - æšä¸¾å®šä¹‰</li>
<li><code>src/request/types/</code> - è¯·æ±‚ç›¸å…³ç±»å‹</li>
<li><code>src/components/request/types/</code> - è¯·æ±‚ç»„ä»¶ç±»å‹</li>
</ul>
<h2 id="é…ç½®è¯´æ˜">é…ç½®è¯´æ˜</h2>
<h3 id="ç¯å¢ƒé…ç½®">ç¯å¢ƒé…ç½®</h3>
<ul>
<li><code>src/config.ts</code> - åº”ç”¨é…ç½®ï¼ŒAPIåœ°å€ã€ç™»å½•é…ç½®ç­‰</li>
<li><code>src/manifest.json</code> - åº”ç”¨æ¸…å•æ–‡ä»¶</li>
<li><code>vite.config.ts</code> - Vite æ„å»ºé…ç½®</li>
<li><code>tsconfig.json</code> - TypeScript é…ç½®</li>
</ul>
<h3 id="api-é…ç½®">API é…ç½®</h3>
<ul>
<li><code>swaggerApi.config.js</code> - Swagger API ç”Ÿæˆé…ç½®</li>
</ul>
<h3 id="eslint-é…ç½®">ESLint é…ç½®</h3>
<ul>
<li><code>components/eslint-config/</code> - ç»Ÿä¸€çš„ ESLint é…ç½®</li>
</ul>
<h2 id="éƒ¨ç½²è¯´æ˜">éƒ¨ç½²è¯´æ˜</h2>
<h3 id="å°ç¨‹åºéƒ¨ç½²">å°ç¨‹åºéƒ¨ç½²</h3>
<ol>
<li>æ„å»ºé¡¹ç›®ï¼š<code>pnpm build</code></li>
<li>ä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·æ‰“å¼€ <code>dist/build/mp-weixin</code> ç›®å½•</li>
<li>ä¸Šä¼ ä»£ç åˆ°å¾®ä¿¡å°ç¨‹åºåå°</li>
</ol>
<h3 id="h5-éƒ¨ç½²">H5 éƒ¨ç½²</h3>
<ol>
<li>æ„å»ºé¡¹ç›®ï¼š<code>pnpm build:h5</code></li>
<li>å°† <code>dist/build/h5</code> ç›®å½•éƒ¨ç½²åˆ° Web æœåŠ¡å™¨</li>
</ol>
<h3 id="app-éƒ¨ç½²">App éƒ¨ç½²</h3>
<ol>
<li>æ„å»ºé¡¹ç›®ï¼š<code>pnpm build:app</code></li>
<li>ä½¿ç”¨ HBuilderX æ‰“å¼€é¡¹ç›®</li>
<li>äº‘æ‰“åŒ…æˆ–æœ¬åœ°æ‰“åŒ…</li>
</ol>
<h2 id="å¸¸è§é—®é¢˜">å¸¸è§é—®é¢˜</h2>
<h3 id="è·¯ç”±ç”Ÿæˆå¤±è´¥">è·¯ç”±ç”Ÿæˆå¤±è´¥</h3>
<p>æ£€æŸ¥ <code>src/pages.json</code> æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼Œç¡®ä¿ JSON è¯­æ³•æ— è¯¯ã€‚</p>
<h3 id="ç»„ä»¶åº“æ ·å¼é—®é¢˜">ç»„ä»¶åº“æ ·å¼é—®é¢˜</h3>
<p>ç¡®ä¿æ­£ç¡®å¼•å…¥äº† Wot Design Uni çš„æ ·å¼æ–‡ä»¶ï¼Œæ£€æŸ¥ <code>src/main.ts</code> ä¸­çš„å¯¼å…¥ã€‚</p>
<h3 id="è¯·æ±‚å¤±è´¥">è¯·æ±‚å¤±è´¥</h3>
<p>æ£€æŸ¥ <code>src/config.ts</code> ä¸­çš„APIåœ°å€é…ç½®ï¼Œç¡®ä¿ç½‘ç»œç¯å¢ƒæ­£å¸¸ã€‚</p>
<h2 id="è´¡çŒ®æŒ‡å—">è´¡çŒ®æŒ‡å—</h2>
<ol>
<li>Fork æœ¬ä»“åº“</li>
<li>åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (<code>git checkout -b feature/AmazingFeature</code>)</li>
<li>æäº¤æ›´æ”¹ (<code>git commit -m 'Add some AmazingFeature'</code>)</li>
<li>æ¨é€åˆ°åˆ†æ”¯ (<code>git push origin feature/AmazingFeature</code>)</li>
<li>æ‰“å¼€ Pull Request</li>
</ol>
<h2 id="æ›´æ–°æ—¥å¿—">æ›´æ–°æ—¥å¿—</h2>
<h3 id="v300">v3.0.0</h3>
<ul>
<li>Monorepo + pnpm workspace æ„å»º</li>
<li>é›†æˆ Vue 3 + TypeScript + Pinia</li>
<li>é›†æˆ Wot Design Uni ç»„ä»¶åº“</li>
<li>æ·»åŠ è‡ªåŠ¨è·¯ç”±ç”Ÿæˆæ’ä»¶</li>
<li>æ·»åŠ é¡µé¢ç›‘å¬æ’ä»¶</li>
<li>å®Œæ•´çš„è¯·æ±‚å°è£…å’Œæ‹¦æˆªå™¨</li>
<li>ä¸°å¯Œçš„Vue 3 Hookså·¥å…·åº“</li>
<li>é˜¿é‡Œäº‘OSSæ–‡ä»¶ä¸Šä¼ é›†æˆ</li>
<li>å®Œæ•´çš„æƒé™ç®¡ç†å’Œç™»å½•æµç¨‹</li>
</ul>
<h2 id="è®¸å¯è¯">è®¸å¯è¯</h2>
<p><a href="LICENSE">ISC</a></p>
<h2 id="è”ç³»æ–¹å¼">è”ç³»æ–¹å¼</h2>
<p>å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š</p>
<ul>
<li>æäº¤ Issue</li>
<li>å‘é€é‚®ä»¶</li>
<li>å‚ä¸è®¨è®º</li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ğŸ‘‰ğŸ‘‰ğŸ‘‰çˆ¬è“æ¹–åŸå‹ç›®å½•ç»“æ„]]></title>
        <id>https://ihopefulchina.github.io/qn_PbZX5g6/</id>
        <link href="https://ihopefulchina.github.io/qn_PbZX5g6/">
        </link>
        <updated>2025-02-14T09:47:03.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ¬æ’ä»¶ç”¨äºçˆ¬ è“æ¹–åŸå‹ç›®å½•ç»“æ„ï¼Œå¯¼å‡ºcsvæ–‡ä»¶ï¼Œå¯ä»¥ç”¨äºé£ä¹¦ç­‰ å¼€å‘é¡¹ç›®åœ¨çº¿æ–‡æ¡£ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ¬æ’ä»¶ç”¨äºçˆ¬ è“æ¹–åŸå‹ç›®å½•ç»“æ„ï¼Œå¯¼å‡ºcsvæ–‡ä»¶ï¼Œå¯ä»¥ç”¨äºé£ä¹¦ç­‰ å¼€å‘é¡¹ç›®åœ¨çº¿æ–‡æ¡£ã€‚</p>
<!-- more -->
<figure data-type="image" tabindex="1"><img src="https://ihopefulchina.github.io/post-images/1739674155883.png" alt="" loading="lazy"></figure>
<p>åŸå‹<br>
<img src="https://ihopefulchina.github.io/post-images/1739526995167.png" alt="" loading="lazy"></p>
<p>åœ¨å…¬å¸å‘ç°ä¸€ä¸ªç—›ç‚¹, éœ€æ±‚æ˜¯è¿™æ ·çš„:</p>
<ul>
<li>è“æ¹–åŸå‹ï¼Œéœ€è¦æŒ‰ç…§ç›®å½•ä¸‹æ¥ï¼Œç„¶åç”Ÿæˆé£ä¹¦åœ¨çº¿å¼€å‘æ–‡æ¡£</li>
<li>ä¼ ç»Ÿä¸Šï¼Œåªèƒ½æ‰‹åŠ¨copy</li>
</ul>
<p>é’ˆå¯¹ä»¥ä¸Šï¼Œå†™ä¸€ä¸ªæ²¹çŒ´è„šæœ¬æ’ä»¶ <a href="https://greasyfork.org/zh-CN/scripts/513139-%E7%88%AC%E8%93%9D%E6%B9%96%E5%8E%9F%E5%9E%8B%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84">çˆ¬è“æ¹–åŸå‹ç›®å½•ç»“æ„</a></p>
<h4 id="ä¸»è¦ç‰¹æ€§">ä¸»è¦ç‰¹æ€§</h4>
<p>ç”Ÿæˆcsvæ–‡ä»¶ï¼Œ ä»»åŠ¡æ¨¡å—copy3ä»½, 3ç§ä»»åŠ¡ç±»å‹ï¼š[æ¥å£å¼€å‘, é¡µé¢å¼€å‘, æ¥å£è”è°ƒ] ï¼Œå¦‚æœæœ‰å…¶ä»–è‡ªå®šä¹‰ï¼Œè‡ªè¡Œè°ƒæ•´ã€‚<br>
ç°å·²æ”¯æŒæŒ‰é’®æ‹–æ‹½ï¼Œå¹¶ç¼“å­˜topï¼Œrightä½ç½®ä¿¡æ¯ï¼Œè§£å†³é®æŒ¡åŸå‹é—®é¢˜ã€‚<br>
æ”¹æˆç”Ÿæˆcsvæ ¼å¼æ–‡ä»¶ï¼Œå…¼å®¹æ€§æ›´å¼ºï¼Œå¯ä»¥åœ¨é£ä¹¦æ–°å»ºä¸€ä¸ªå¤šç»´è¡¨æ ¼ï¼Œç„¶åé€‰æ‹©å¯¼å…¥Excelç”Ÿæˆçš„æ–‡ä»¶ã€‚</p>
<h4 id="åç»­æ”¯æŒ">åç»­æ”¯æŒ</h4>
<p>æ”¯æŒæ•°æ®ç±»å‹æ›´ä¸°å¯Œï¼Œæ¯”å¦‚æ·»åŠ å¼€å‘äººå‘˜ä¿¡æ¯</p>
<p>ç”Ÿæˆçš„Excel<br>
<img src="https://ihopefulchina.github.io/post-images/1739527027563.png" alt="" loading="lazy"></p>
<p>å¯¼å…¥åˆ°é£ä¹¦<br>
<img src="https://ihopefulchina.github.io/post-images/1739674155883.png" alt="" loading="lazy"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è‡ªå®šä¹‰Hooks: usePullToRefresh(Vue3) - åˆ—è¡¨ç»„ä»¶ä¸­è½»æ¾å®ç°ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½æ›´å¤šåŠŸèƒ½]]></title>
        <id>https://ihopefulchina.github.io/4PEcn6ZhYy/</id>
        <link href="https://ihopefulchina.github.io/4PEcn6ZhYy/">
        </link>
        <updated>2024-12-20T01:32:47.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨ Vue 3 ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ Hook æ¥å°†ä¸šåŠ¡é€»è¾‘ä»ç»„ä»¶ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œä½¿å¾—æˆ‘ä»¬çš„ç»„ä»¶æ›´åŠ ç®€æ´å’Œæ˜“äºç»´æŠ¤ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ PullToRefresh Hookï¼Œè¯¥ Hook å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨åˆ—è¡¨ç»„ä»¶ä¸­è½»æ¾å®ç°ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½æ›´å¤šåŠŸèƒ½ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨ Vue 3 ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ Hook æ¥å°†ä¸šåŠ¡é€»è¾‘ä»ç»„ä»¶ä¸­æŠ½ç¦»å‡ºæ¥ï¼Œä½¿å¾—æˆ‘ä»¬çš„ç»„ä»¶æ›´åŠ ç®€æ´å’Œæ˜“äºç»´æŠ¤ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ PullToRefresh Hookï¼Œè¯¥ Hook å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨åˆ—è¡¨ç»„ä»¶ä¸­è½»æ¾å®ç°ä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½æ›´å¤šåŠŸèƒ½ã€‚</p>
<!-- more -->
<h3 id="èƒŒæ™¯">èƒŒæ™¯</h3>
<p>åœ¨è®¸å¤šç§»åŠ¨ç«¯åº”ç”¨æˆ– Web åº”ç”¨ä¸­ï¼Œä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½æ›´å¤šåŠŸèƒ½æ˜¯éå¸¸å¸¸è§çš„äº¤äº’æ–¹å¼ã€‚ä¸ºäº†å®ç°è¿™ä¸€åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ç®¡ç†åˆ†é¡µçŠ¶æ€ã€åŠ è½½çŠ¶æ€ã€æ•°æ®åˆå¹¶ç­‰å¤šä¸ªæ–¹é¢çš„é€»è¾‘ã€‚é€šè¿‡ä½¿ç”¨ Vue 3 çš„ç»„åˆå¼ APIï¼ˆComposition APIï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›é€»è¾‘å°è£…æˆä¸€ä¸ªé€šç”¨çš„ Hookï¼Œä½¿å¾—ä»£ç æ›´åŠ å¤ç”¨å’Œæ˜“äºç»´æŠ¤ã€‚</p>
<ol>
<li>éœ€æ±‚åˆ†æ</li>
</ol>
<p>æˆ‘ä»¬éœ€è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š<br>
â€¢	æ”¯æŒä¸‹æ‹‰åˆ·æ–°å’Œä¸Šæ‹‰åŠ è½½æ›´å¤šã€‚<br>
â€¢	æ”¯æŒåˆ†é¡µåŠ è½½ï¼Œæ¯æ¬¡è¯·æ±‚æ—¶ï¼Œéƒ½ä¼šè¿”å›ä¸€é¡µçš„æ•°æ®ã€‚<br>
â€¢	æ”¯æŒæ•°æ®çš„å»é‡å¤„ç†ï¼Œé˜²æ­¢åŠ è½½é‡å¤çš„æ•°æ®ã€‚<br>
â€¢	æ”¯æŒåˆ·æ–°æ—¶æ¸…ç©ºæ—§æ•°æ®ã€‚<br>
â€¢	æ”¯æŒè‡ªå®šä¹‰æ•°æ®æ ¼å¼åŒ–ã€‚<br>
â€¢	æ”¯æŒåˆ·æ–°å®Œæˆåçš„å›è°ƒï¼Œä»¥ä¾¿å¤„ç†åˆ—è¡¨æ•°æ®ã€‚</p>
<ol start="2">
<li>ä»£ç å®ç°</li>
</ol>
<p>ä¸‹é¢æ˜¯æˆ‘ä»¬å®ç°çš„ usePullToRefresh Hook ä»£ç ï¼š</p>
<pre><code>import { computed, onMounted, ref } from 'vue';
import { useLockFn } from '~/hooks';
import { removeRepetition } from '~/utils';

export enum PullToRefreshState {
    /**
     * æ™®é€šçŠ¶æ€
     */
    none,
    /**
     * åˆ·æ–°ä¸­
     */
    refreshing,
    /**
     * æ·»åŠ ä¸­
     */
    pushing,
}

export interface IPullRefreshHookRefreshParams {
    /**
     * åˆ·æ–°æ—¶æ˜¯å¦æ¸…ç©ºæ—§æ•°ç»„
     *
     * @default false
     */
    clearList?: boolean;
}

interface IUsePullToRefreshOption&lt;T&gt; {
    /** é»˜è®¤æ•°æ® */
    defaultData?: T[];
    /** é»˜è®¤åˆå§‹æ’å…¥æ•°æ® */
    defaultInsertData?: T[];
    dataKey?: string;
    /** åˆå§‹æ˜¯å¦å‘å‡ºè¯·æ±‚ */
    initRequest?: boolean;

    /** è·å–æ•°æ® */
    getData: (data: Record&lt;string, any&gt; 
    &amp; { pageNum: number }) =&gt; Promise&lt;{ data?: { list?: T[]; 
    isLastPage?: boolean; total?: number } }&gt;;

    /** æ•°æ®æ ¼å¼åŒ– */
    dataFormat?(data: T[]): any[];

    /** è·å–æ•°æ®å®Œæˆå›è°ƒï¼Œè¿”å›æœ¬æ¬¡æ•°æ® */
    onAfterLoad?(data: T[], currentParams: Record&lt;string, any&gt;
     &amp; { pageNum: number }, total: number, isLastPage: boolean): void;
    /** è·å–æ•°æ®å®Œæˆå›è°ƒï¼Œè¿”å›å½“å‰listã€currentParams */
    customSpliceList?(list: T[], currentParams: Record&lt;string, any&gt; 
    &amp; { pageNum: number }): void;
}

export default function usePullToRefresh&lt;T&gt;(config: IUsePullToRefreshOption&lt;T&gt;) {
    const { defaultData = [], dataKey = 'id' } = config;
    const list = ref&lt;any[]&gt;(defaultData);
    const total = ref&lt;number&gt;(0);
    const noMore = ref&lt;boolean&gt;(false);

    const pullToRefreshState = ref&lt;PullToRefreshState&gt;(PullToRefreshState.refreshing);
    const requestId = ref&lt;number&gt;(0);
    const pageNum = ref&lt;number&gt;(0);

    const getListData = useLockFn(async (num?: number) =&gt; {
        if (num !== undefined) {
            pageNum.value = num;
        } else {
            pageNum.value++;
        }

        if (pageNum.value === 1) {
            pullToRefreshState.value = PullToRefreshState.refreshing;
            // setData([]);
        } else {
            pullToRefreshState.value = PullToRefreshState.pushing;
        }

        try {
            const currentRequestId = ++requestId.value;
            const currentParams = { pageNum: pageNum.value, pageSize: 10 };

            const { data = {} } = await config.getData(currentParams);
            if (currentRequestId !== requestId.value) {
                return;
            }
            // eslint-disable-next-line prefer-const
            let { list: dataList = [], isLastPage } = data;

            dataList = config.dataFormat ?
             config.dataFormat(dataList) : dataList;

            if (config.onAfterLoad) {
                config.onAfterLoad(dataList, currentParams, data?.total 
                || -1, !!isLastPage);
            }

            if (pageNum.value === 1) {
                list.value = (config.defaultInsertData ?
                 [...config.defaultInsertData, ...dataList] : dataList) || [];
            } else {
                dataList = removeRepetition((list.value || [])
                ?.concat(dataList), dataKey);
                list.value = dataList;
            }

            if (config.customSpliceList) {
                config.customSpliceList(dataList, currentParams);
            }
            total.value = data?.total || -1;
            noMore.value = isLastPage !== undefined ?
             !!isLastPage : data?.total !== -1 ?
             dataList?.length &gt;= (data?.total || -1) : true;
        } catch (error) {
            if (pageNum.value === 1) {
                list.value = [];
            }
        }
        pullToRefreshState.value = PullToRefreshState.none;
    });

    /**
     * æ›´æ–°æŸæ¡æ•°æ®çš„å€¼
     *
     * @param updatedata
     */
    function updateById(updatedata: T, key = 'id') {
        const newList = [...list.value]?.map((value) =&gt; {
            if ((value as any)[key] === (updatedata as any)[key]) {
                /** æ”¹æˆæ›¿æ¢æ›´æ–° */
                return { ...updatedata };
            }
            return { ...value };
        });

        list.value = [...newList];
    }

    /**
     * åˆ é™¤æŸæ¡æ•°æ®çš„å€¼
     *
     * @param id
     */
    function deleteById(id: number | string, key = 'id') {
        list.value = list.value?.filter((item) =&gt; `${item[key]}` !== `${id}`);
    }

    /**
     * æ›´æ–°åˆ—è¡¨ä¸­çš„æ•°æ®
     *
     * @param {T} data éœ€è¦æ›´æ–°çš„æ•°æ®
     * @param {(string | ((item: T, index: number) =&gt; boolean))} compare æ¯”å¯¹é€»è¾‘
     */
    function updateLisItem(data: T, compare: string 
    | ((item: T, index: number) =&gt; boolean)) {
        const isString = typeof compare === 'string';
        list.value = list.value?.map((value, index) =&gt; {
            if (isString) {
                return (value as any)[compare] === (data as any)[compare] ? 
                { ...value, ...data } : value;
            }
            return compare(value, index) ? { ...value, ...data } : value;
        });
    }

    onMounted(() =&gt; {
        if (config?.initRequest !== false) {
            getListData();
        }
    });

    function onRefresh(refreshParams?: IPullRefreshHookRefreshParams) {
        if (refreshParams?.clearList) {
            list.value = [];
        }
        getListData(1);
    }

    const isEmpty = computed(() =&gt; list?.value.length === 0 
    &amp;&amp; pullToRefreshState?.value === PullToRefreshState.none);

    return {
        list,
        setList: list.value,
        total,
        updateById,
        pageNum,
        updateLisItem,
        deleteByIndex: (index: number) =&gt; (list.value = list.value
        ?.filter((__, idx) =&gt; idx !== index)),
        /** æ ¹æ®ä¼ å…¥çš„æ ‡è¯†åˆ é™¤å¯¹åº”çš„æ•°æ®ï¼Œä¼ å…¥æ ‡è¯†å€¼å’Œæ ‡è¯†å­—æ®µï¼Œé»˜è®¤id */
        deleteById,
        state: pullToRefreshState,
        noMore,
        onRefresh,
        isEmpty,
        onReachBottom: () =&gt; getListData(),
    };
}
</code></pre>
<h3 id="ä½¿ç”¨å®ä¾‹">ä½¿ç”¨å®ä¾‹</h3>
<pre><code>// åˆ—è¡¨æ•°æ®
const pullToProps = useMMPullToRefresh&lt;UpWorkHistoryPageVO&gt;({
    initRequest: false,
    getData: (params) =&gt; {
        if (type.value === EStaffBillPermission.REPAIR) {
            return api['/wechat/api/repairWorkOrderSignHistory/page_GET']
            ({ ...params, id: pageQuery?.value?.id });
        }
        return api['/wechat/api/upWorkOrder/historyPage_GET']
        ({ ...params, id: pageQuery?.value?.id, type: ESignInType.SIGN_IN });
    },
});
const { list, isEmpty } = toRefs(pullToProps);

&lt;PullToRefresh
                :noMore=&quot;pullToProps?.noMore&quot;
                :state=&quot;pullToProps?.state&quot;
                :isEmpty=&quot;pullToProps?.isEmpty&quot;
                @onRefresh=&quot;pullToProps?.onRefresh&quot;
                @onReachBottom=&quot;pullToProps?.onReachBottom&quot;
                refresherBackground=&quot;#fff&quot;
            &gt;
                &lt;view class=&quot;list&quot; v-if=&quot;list &amp;&amp; list?.length &gt; 0&quot;&gt;
                    &lt;view class=&quot;item&quot; v-for=&quot;item in list&quot; :key=&quot;item?.id&quot;&gt;
                        &lt;Item :item=&quot;item&quot; :type=&quot;type&quot; /&gt;
                    &lt;/view&gt;
                &lt;/view&gt;
                &lt;view v-else-if=&quot;isEmpty&quot;&gt;
                    &lt;Empty marginTop=&quot;440&quot; :emptyStr=&quot;t('common.no_data')&quot; /&gt;
                &lt;/view&gt;
            &lt;/PullToRefresh&gt;
        ```
PullToRefresh ç»„ä»¶æºç (ä»…ä¾›å‚è€ƒï¼Œç›¸å…³é€»è¾‘æ ¹æ®é¡¹ç›®å®é™…ä¸šåŠ¡åœºæ™¯)
</code></pre>
<script lang="ts" setup>
import { CSSProperties, ComputedRef, Ref, computed, getCurrentInstance, onMounted, ref, toRefs } from 'vue';
import Gap from '~/components/common/gap/Gap.vue';
import { useLockFn } from '~/hooks';
import { useSystemInfo } from '~/state/useSystemInfo';
import TnLoadmore from '~/uni_modules/tuniaoui-vue3/components/loadmore/src/loadmore.vue';
import { selectRect } from '~/utils/uniApi';
import { MMPullToRefreshState } from './const';

/** è®¾ç½®è‡ªå®šä¹‰ä¸‹æ‹‰åˆ·æ–°é˜ˆå€¼ */
const REFRESHER_THRESHOLD = 45;

interface IMMPullToRefreshProps {
    /** åˆ·æ–°çŠ¶æ€ */
    state: Ref<MMPullToRefreshState>;
    /** æ²¡æœ‰æ›´å¤š */
    noMore: Ref<boolean>;
    /** æ˜¯å¦æ˜¾ç¤ºæ²¡æœ‰æ›´å¤šæ–‡æ¡ˆï¼Œé»˜è®¤æ˜¾ç¤º */
    hiddeNoMoreText?: boolean;
    /** æ˜¯å¦ç©ºæ•°æ® */
    isEmpty?: ComputedRef<boolean>;
    /** åˆ—è¡¨é«˜åº¦ */
    height?: number;
    /** styles */
    styles?: CSSProperties;
    /** isTab */
    isTab?: boolean;
    /** èƒŒæ™¯é¢œè‰² */
    refresherBackground?: string;
    /** åº•éƒ¨ç©ºé—´é«˜åº¦ rpx */
    footerSpace?: number;
    /** é¡µé¢æ»šåŠ¨å›æ‰ */
    onScroll?: (e: any) => void;
}

/** å­ä¼ çˆ¶äº‹ä»¶ */
const emits = defineEmits<{
    (e: 'onRefresh'): void;
    (e: 'onReachBottom'): void;
}>();
const systemInfo = useSystemInfo();
const instance = getCurrentInstance(); // è·å–ç»„ä»¶å®ä¾‹

/** çˆ¶ä¼ å­å‚æ•° */
const props = defineProps<IMMPullToRefreshProps>();
const { noMore, state, isEmpty } = toRefs(props);

/** åˆ—è¡¨é«˜åº¦è®¡ç®— */
const scollViewHeight = ref<number>();
const calculateScrollViewHeight = async () => {
    let scrollViewHeight = props?.height;
    try {
        if (!scrollViewHeight) {
            const topViewRes: any = await selectRect('#MMPullToRefreshTop', instance!);

            scrollViewHeight = systemInfo?.screenHeight - topViewRes?.top;
        }
    } catch (error) {
        console.warn(error);
    }

    scollViewHeight.value = props?.isTab && scrollViewHeight ? scrollViewHeight - systemInfo?.tabbarHeight : scrollViewHeight;
};
onMounted(() => {
    calculateScrollViewHeight();
});

/** åŠ è½½æ›´å¤šstatus */
const status = computed<'loading' | 'nomore' | undefined>(() => {
    if (state?.value === MMPullToRefreshState.pushing) {
        return 'loading';
    } else if (state.value !== MMPullToRefreshState.refreshing && noMore) {
        return 'nomore';
    }
    return undefined;
});

/** å¼€å¯è‡ªå®šä¹‰ä¸‹æ‹‰åˆ·æ–° */
// const refresherTriggered = computed(() => state?.value === MMPullToRefreshState.refreshing);
const refresherTriggered = ref<boolean>(false);
/** åˆ·æ–°åˆ—è¡¨ */
const refresherrefresh = useLockFn(async () => {
    refresherTriggered.value = true;
    if (state.value === MMPullToRefreshState.none) {
        emits('onRefresh');
        setTimeout(() => {
            refresherTriggered.value = false;
        }, 500);
    }
});

const onScroll = (event: any) => {
    props.onScroll?.(event);
};

/** ä¸‹æ‹‰æ›´å¤š */
const scrolltolower = () => {
    if (!noMore?.value) {
        emits('onReachBottom');
    }
};
</script>
<template>
    <view class="MMPullToRefresh" :style="{ height: `${scollViewHeight}px` }">
        <view id="MMPullToRefreshTop" />
        <!-- <view class="pullHead" v-if="refresherTriggered">
            <TnLoadmore size="36" status="loading" color="#999" :loadingText="false" loadingIconMode="flower" />
        </view> -->
        <scroll-view
            scrollY
            scrollWithAnimation
            enableBackToTop
            refresherEnabled
            refresherDefaultStyle="black"
            :refresherThreshold="REFRESHER_THRESHOLD"
            :refresherTriggered="refresherTriggered"
            :refresherBackground="props?.refresherBackground ?? '#fff'"
            @refresherrefresh="refresherrefresh"
            @scrolltolower="scrolltolower"
            @scroll="onScroll"
            class="simplePullToRefresh"
            :style="{ ...props.styles }"
        >
            <!-- <slot name="refresher">
                <view class="pullHead">
                    <TnLoadmore size="36" status="loading" color="#999" :loadingText="false" loadingIconMode="flower" />
                </view>
            </slot> -->
            <slot></slot>
<pre><code>        &lt;view class=&quot;noMore&quot; v-if=&quot;!isEmpty &amp;&amp; (status !== 'nomore' || (status === 'nomore' &amp;&amp; !props.hiddeNoMoreText))&quot;&gt;
            &lt;TnLoadmore :status=&quot;status&quot; v-if=&quot;status&quot; color=&quot;#999&quot; loadingIconMode=&quot;flower&quot; /&gt;
        &lt;/view&gt;
        &lt;Gap :height=&quot;props?.footerSpace&quot; v-if=&quot;props?.footerSpace&quot; :styles=&quot;{ width: '100%' }&quot; /&gt;
    &lt;/scroll-view&gt;
&lt;/view&gt;
</code></pre>
</template>
<style lang="scss" scoped>
@import './index.scss';
</style>
<pre><code></code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è‡ªå®šä¹‰Hooks: useMutate(Vue3) - ç®€å•çš„è·å–æ•°æ®æ–¹æ³•çš„ä¸€ä¸ªå°è£…]]></title>
        <id>https://ihopefulchina.github.io/aJA508HwI4/</id>
        <link href="https://ihopefulchina.github.io/aJA508HwI4/">
        </link>
        <updated>2024-10-17T05:39:42.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨ Vue 3 ä¸­ï¼Œç»„åˆå¼ APIï¼ˆComposition APIï¼‰ä¸ºæˆ‘ä»¬æä¾›äº†æ›´çµæ´»çš„æ–¹å¼æ¥ç»„ç»‡ä»£ç ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†å®ç°ä¸€ä¸ªé€šç”¨çš„ useMutate Hookï¼Œç”¨äºå¤„ç†æ•°æ®è¯·æ±‚å¹¶æ›´æ–°ç»„ä»¶ä¸­çš„æ•°æ®çŠ¶æ€ã€‚è¿™ä¸ª Hook å°†å¸®åŠ©æˆ‘ä»¬å°è£…æ•°æ®è·å–ã€æ ¼å¼åŒ–ã€çŠ¶æ€ç®¡ç†ç­‰é€»è¾‘ï¼Œä»è€Œä½¿å¾—ç»„ä»¶æ›´ç®€æ´ä¸”æ˜“äºå¤ç”¨ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨ Vue 3 ä¸­ï¼Œç»„åˆå¼ APIï¼ˆComposition APIï¼‰ä¸ºæˆ‘ä»¬æä¾›äº†æ›´çµæ´»çš„æ–¹å¼æ¥ç»„ç»‡ä»£ç ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å°†å®ç°ä¸€ä¸ªé€šç”¨çš„ useMutate Hookï¼Œç”¨äºå¤„ç†æ•°æ®è¯·æ±‚å¹¶æ›´æ–°ç»„ä»¶ä¸­çš„æ•°æ®çŠ¶æ€ã€‚è¿™ä¸ª Hook å°†å¸®åŠ©æˆ‘ä»¬å°è£…æ•°æ®è·å–ã€æ ¼å¼åŒ–ã€çŠ¶æ€ç®¡ç†ç­‰é€»è¾‘ï¼Œä»è€Œä½¿å¾—ç»„ä»¶æ›´ç®€æ´ä¸”æ˜“äºå¤ç”¨ã€‚</p>
<!-- more -->
<h3 id="èƒŒæ™¯">èƒŒæ™¯</h3>
<p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œæ•°æ®çš„è¯·æ±‚å’Œå±•ç¤ºæ˜¯å¸¸è§çš„åŠŸèƒ½ã€‚ä¸ºäº†é¿å…åœ¨æ¯ä¸ªç»„ä»¶ä¸­é‡å¤ç›¸ä¼¼çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®è¯·æ±‚çš„é€»è¾‘æŠ½è±¡æˆä¸€ä¸ªå¯å¤ç”¨çš„ Hookã€‚useMutate Hook çš„ç›®æ ‡å°±æ˜¯å°è£…æ•°æ®è¯·æ±‚ã€å¤„ç†æ— æ•°æ®çŠ¶æ€å’Œæ ¼å¼åŒ–æ•°æ®çš„é€»è¾‘ï¼Œå¸®åŠ©æˆ‘ä»¬ç®€åŒ–ä»£ç å¹¶æé«˜å¼€å‘æ•ˆç‡ã€‚</p>
<h3 id="éœ€æ±‚åˆ†æ">éœ€æ±‚åˆ†æ</h3>
<p>æˆ‘ä»¬éœ€è¦å®ç°ä»¥ä¸‹åŠŸèƒ½ï¼š<br>
1.	æ•°æ®è¯·æ±‚ï¼š å‘æœåŠ¡å™¨è¯·æ±‚æ•°æ®ã€‚<br>
2.	æ•°æ®æ ¼å¼åŒ–ï¼š æ”¯æŒè‡ªå®šä¹‰çš„æ•°æ®æ ¼å¼åŒ–å‡½æ•°ã€‚<br>
3.	è¯·æ±‚æˆåŠŸå›è°ƒï¼š è¯·æ±‚æˆåŠŸåè§¦å‘å›è°ƒï¼Œæ–¹ä¾¿åç»­æ“ä½œã€‚<br>
4.	æ— æ•°æ®çŠ¶æ€ç®¡ç†ï¼š åˆ¤æ–­è¿”å›æ•°æ®æ˜¯å¦ä¸ºç©ºï¼Œå¹¶æ›´æ–° noData çŠ¶æ€ã€‚</p>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<p>ä¸‹é¢æ˜¯æˆ‘ä»¬å®ç°çš„ useMutate Hookï¼š</p>
<pre><code>import { onMounted, ref } from 'vue';
import { useLockFn } from './useLockFn';

interface IMutateOption&lt;T&gt; {
    /** é»˜è®¤æ•°æ® */
    defaultData?: T;

    /** é¢å¤–ä¼ é€’å‚æ•° */
    params?: Record&lt;string, any&gt;;

    /** åˆå§‹æ˜¯å¦å‘å‡ºè¯·æ±‚ */
    initRequest?: boolean;

    /** è·å–æ•°æ® */
    getData: (data: Record&lt;string, any&gt;) =&gt; Promise&lt;{ data?: T }&gt;;

    /** æ•°æ®æ ¼å¼åŒ– */
    dataFormat?(data?: T): any;

    /** è¯·æ±‚æˆåŠŸåçš„å›è°ƒ */
    successCallback?(data?: T): void;
}

export function useMutate&lt;T&gt;(config: IMutateOption&lt;T&gt;) {
    const { defaultData, params, initRequest = true } = config;
    const detail = ref&lt;T | undefined&gt;(defaultData);
    const noData = ref&lt;boolean&gt;();
    const isInit = ref(initRequest);

    const mutate = useLockFn(async () =&gt; {
        try {
            const { data } = await config.getData({ ...params });
            const newData = config.dataFormat ? config.dataFormat(data) : data;

            detail.value = newData;
            config?.successCallback?.(newData);

            /**æš‚æ— æ•°æ® */
            let blo = false;

            if (newData !== undefined) {
                if (newData instanceof Array) {
                    blo = newData.length === 0;
                } else if (newData instanceof Object) {
                    blo = Object.keys(newData).length === 0;
                }
            } else {
                blo = true;
            }

            noData.value = blo;
        } catch (error) {
            console.log(error);
            noData.value = true;
        }
    }, 500);

    onMounted(() =&gt; {
        if (!isInit.value) {
            isInit.value = true;
        } else {
            mutate();
        }
    });

    return { mutate, detail, noData };
}
</code></pre>
<h3 id="ä½¿ç”¨ç¤ºä¾‹">ä½¿ç”¨ç¤ºä¾‹</h3>
<pre><code>const { detail, mutate, noData } = useMutate({
    getData: () =&gt; api['/wechat/api/outWorkOrder/express/{id}_GET'](1),
});
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://ihopefulchina.github.io/post-images/1739756542887.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è‡ªå®šä¹‰Hooks: useProTableRequest â€”â€” Ant Design Pro Table è¯·æ±‚å°è£…]]></title>
        <id>https://ihopefulchina.github.io/vrE64S-kvU/</id>
        <link href="https://ihopefulchina.github.io/vrE64S-kvU/">
        </link>
        <updated>2024-08-06T07:26:46.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å¤„ç†è¡¨æ ¼æ•°æ®çš„è¯·æ±‚ã€ç¼“å­˜ã€å¯¼å‡ºç­‰åŠŸèƒ½ã€‚ä¸ºäº†æé«˜ä»£ç çš„å¤ç”¨æ€§å’Œç®€æ´æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›é€»è¾‘å°è£…åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ Hook ä¸­ã€‚æœ¬æ–‡å°†ä»‹ç»ä¸€ä¸ªåŸºäº Ant Design Pro Table çš„è¡¨æ ¼è¯·æ±‚å°è£… Hook â€”â€” useProTableRequestï¼Œå¹¶æ·±å…¥è®²è§£å…¶å·¥ä½œåŸç†å’Œå¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å¤„ç†è¡¨æ ¼æ•°æ®çš„è¯·æ±‚ã€ç¼“å­˜ã€å¯¼å‡ºç­‰åŠŸèƒ½ã€‚ä¸ºäº†æé«˜ä»£ç çš„å¤ç”¨æ€§å’Œç®€æ´æ€§ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº›é€»è¾‘å°è£…åˆ°ä¸€ä¸ªè‡ªå®šä¹‰ Hook ä¸­ã€‚æœ¬æ–‡å°†ä»‹ç»ä¸€ä¸ªåŸºäº Ant Design Pro Table çš„è¡¨æ ¼è¯·æ±‚å°è£… Hook â€”â€” useProTableRequestï¼Œå¹¶æ·±å…¥è®²è§£å…¶å·¥ä½œåŸç†å’Œå¦‚ä½•åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ã€‚</p>
<!-- more -->
<h3 id="åŠŸèƒ½æ¦‚è¿°">åŠŸèƒ½æ¦‚è¿°</h3>
<p>useProTableRequest æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†è¡¨æ ¼æ•°æ®è¯·æ±‚çš„è‡ªå®šä¹‰ Hookï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹åŠŸèƒ½ï¼š<br>
â€¢	æ•°æ®è¯·æ±‚ï¼šä»æœåŠ¡å™¨è·å–æ•°æ®ï¼Œå¹¶æ”¯æŒåˆ†é¡µã€æ’åºå’Œç­›é€‰åŠŸèƒ½ã€‚<br>
â€¢	æ•°æ®ç¼“å­˜ï¼šç¼“å­˜è¯·æ±‚çš„å‚æ•°å’Œæ•°æ®ï¼Œæ–¹ä¾¿åœ¨ç”¨æˆ·è¿”å›è¯¥é¡µé¢æ—¶æ¢å¤è¡¨æ ¼çŠ¶æ€ï¼ˆå¦‚åˆ†é¡µã€ç­›é€‰ç­‰ï¼‰ã€‚<br>
â€¢	å‚æ•°æ ¼å¼åŒ–ï¼šå¯ä»¥è‡ªå®šä¹‰æ ¼å¼åŒ–è¯·æ±‚å‚æ•°å’Œè¿”å›çš„æ•°æ®</p>
<h3 id="ä»£ç code">ä»£ç code</h3>
<pre><code>import { ActionType, ProFormInstance, RequestData } from '@ant-design/pro-components'
import { SortOrder } from 'antd/lib/table/interface'
import React, { useCallback, useEffect, useLayoutEffect, useRef } from 'react'

type Params&lt;U&gt; = U &amp; {
  pageSize?: number
  current?: number
  keyword?: string
}

type Sort = Record&lt;string, SortOrder&gt;

type Filter = Record&lt;string, React.ReactText[] | null&gt;

type Fn&lt;U, T&gt; = (
  params: any,
  sort: Sort,
  filter: Filter
) =&gt; Promise&lt;{ code?: number; msg?: string; data?: { list?: T[]; total?: number } }&gt;

export interface IUseProTableRequestOption&lt;T, U = T&gt; {

  /** éœ€è¦ç¼“å­˜çš„ç›®æ ‡é“¾æ¥åœ°å€
   *  ç›®çš„: ç¼“å­˜åˆ—è¡¨é¡µçš„è¯·æ±‚å‚æ•°ï¼Œä¾‹å¦‚åˆ†é¡µã€æ’åºã€æœç´¢ç­‰å‚æ•°ï¼Œæ–¹ä¾¿è¯¦æƒ…å›åˆ—è¡¨é¡µæ—¶è‡ªåŠ¨æ¢å¤
   *  @example [routeNames.userManagementUserListUserDetail]
   */
  cacheUrls?: string[]
  /**
   * æ ¼å¼åŒ–æ•°æ®
   * ä½ å¯ä»¥å¯¹è¿”å›çš„æ•°æ®åšä¸€äº›å¤„ç†
   */
  dataFormat?: (data: T[]) =&gt; U[]
  /**
   * æ ¼å¼åŒ–å‚æ•°
   *
   * å‰ç½®å¤„ç†è¯·æ±‚å‚æ•°ã€‚å¦‚æœä½ éœ€è¦ä¼ é€’ç»™å¯¼å‡ºæ—¶ã€‚è¿™ä¼šå¾ˆæœ‰ç”¨
   * @param params å°†è¦ä¼ é€’ç»™æ¥å£çš„å‚æ•°
   */
  paramsFormat?(params: any): any
}

/**
 * antd pro tableè¯·æ±‚å°è£…é’©å­
 * @param fn
 * @param option
 * @returns
 */
export default function useProTableRequest&lt;T, U extends Record&lt;string, any&gt; = {}&gt;(
  fn: Fn&lt;U, T&gt;,
  option: IUseProTableRequestOption&lt;T&gt; = {}
) {
  const { dataFormat, cacheUrls } = option

  // Table action çš„å¼•ç”¨ï¼Œä¾¿äºè‡ªå®šä¹‰è§¦å‘
  const actionRef = useRef&lt;ActionType&gt;()

  const formRef = useRef&lt;ProFormInstance&gt;()
  // ç¼“å­˜è¯·æ±‚å‚æ•°
  const requestParams = useRef&lt;Record&lt;string, any&gt;&gt;({})
  // æ•°æ®ç¼“å­˜å‚æ•°
  const dataSourceRef = useRef&lt;T[]&gt;([])

  /** ç¼“å­˜å‚æ•° */
  const _cacheData = useRef&lt;any&gt;(undefined)
  /** ç¼“å­˜key */
  const cacheKey = genCacheKey()
  /** å½“å‰æ˜¯å¦éœ€è¦ç¼“å­˜ */
  const needCache = !!cacheUrls?.length

  // è¡¨æ ¼è¯·æ±‚
  const tableRequst = useCallback(async (params: Params&lt;U&gt;, sort: Sort, filter: Filter) =&gt; {
    const { current, ...rest } = params as Record&lt;string, any&gt;
    const newParams: any = { ...rest, pageNum: current ?? params?.pageNum ?? 1 }

    // é‡ç½®æ•°æ®
    let total = 0
    let data: T[] = []

    requestParams.current = option.paramsFormat ? option.paramsFormat(newParams) : newParams

    try {
      // å‚æ•°é•¿åº¦è¿‡é•¿ä¸å¤„ç†
      if (JSON.stringify(requestParams.current).length &lt; 1000) {
        const res = await fn(requestParams.current, sort, filter)
        // å¦‚æœå½“å‰åˆ—è¡¨ä¸ºç©ºå¹¶ä¸”pageNumä¸ä¸º1.åˆ™é‡æ–°å‘èµ·è¯·æ±‚
        if (!res.data?.list?.length &amp;&amp; requestParams.current.pageNum !== 1) {
          setTimeout(() =&gt; {
            actionRef.current?.reload(true)
          })
        }
        const { list = [] as T[] } = res.data || {}
        total = res.data?.total || 0
        data = dataFormat ? dataFormat(list) : list
        // ç¼“å­˜æ•°æ®
        _cacheData.current = { ...requestParams.current }

        dataSourceRef.current = data
      }
    } catch (error) {}
    // }

    return { data, success: true, total } as Partial&lt;RequestData&lt;T&gt;&gt;
  }, [])

  /** æ¢å¤ç¼“å­˜ */
  const restoreCache = () =&gt; {
    if (needCache) {
      const cacheString = window.sessionStorage.getItem(cacheKey)

      if (cacheString) {
        try {
          const cacheParams = JSON.parse(cacheString)

          /** æ¢å¤è¯·æ±‚å‚æ•° */
          _cacheData.current = cacheParams
          /** æ¢å¤æœç´¢è¡¨å• */
          formRef.current?.setFieldsValue(cacheParams)
          /** æ¢å¤åˆ†é¡µä¿¡æ¯ */
          actionRef.current?.setPageInfo?.({
            current: cacheParams?.current ?? cacheParams?.pageNum ?? 1,
            pageSize: cacheParams?.pageSize
          })
        } catch (error) {
        } finally {
          window.sessionStorage.removeItem(cacheKey) // æ¸…é™¤ç¼“å­˜æ•°æ®
        }
      }
    }
  }
  useLayoutEffect(() =&gt; {
    restoreCache()
  }, [])
  /**
   * è¡¨æ ¼æ•°æ®ç¼“å­˜å¤„ç†
   */
  useEffect(() =&gt; {
    return () =&gt; {
      if (!needCache) {
        return
      }

      // ç»„ä»¶å¸è½½æ—¶å°†æ•°æ®ç¼“å­˜è‡³sessionStorage
      const to = pick(window.location, ['hash', 'href', 'protocol', 'port', 'search', 'pathname', 'hostname'])

      const toCache = cacheUrls?.some((url) =&gt; to?.href?.includes(url))
      if (toCache) {
        window.sessionStorage.setItem(cacheKey, JSON.stringify(_cacheData.current))
      }
    }
  }, [])

  return {
    formRef,
    actionRef,
    /**
     * è¡¨æ ¼è¯·æ±‚
     */
    request: tableRequst,
    /**
     * è¡¨æ ¼queryå‚æ•°
     */
    params: requestParams,

    /**
     * è¡¨æ ¼æ•°æ®ç¼“å­˜
     */
    dataSource: dataSourceRef
  }
}

/**
 * ä»å¯¹è±¡ä¸­é€‰æ‹©æŒ‡å®šçš„å±æ€§
 * @param obj
 * @param keys
 * @returns
 */
function pick&lt;T extends Object, K extends keyof T&gt;(obj: T, keys: K[]): Pick&lt;T, K&gt; {
  const result = {} as Pick&lt;T, K&gt;
  keys.forEach((key) =&gt; {
    if (key in obj) {
      result[key] = obj[key]
    }
  })
  return result
}

/**
 * ç”Ÿæˆç¼“å­˜é”®å€¼
 * @param key key
 * @returns
 */
function genCacheKey(key?: string | ((ok: string) =&gt; string)) {
  const hostKey = encodeURIComponent(window.location.href.replace(/http(s)?:\/\//, ''))
  if (typeof key === 'function') {
    return key(hostKey)
  }
  return key || hostKey
}
</code></pre>
<h3 id="ç®€å•å®ä¾‹">ç®€å•å®ä¾‹</h3>
<pre><code> const { request, actionRef, formRef } = useProTableRequest(api['/admin/mall/banner/queryList_GET'])
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://ihopefulchina.github.io/post-images/1739777358410.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[æ’ä»¶: è‡ªåŠ¨ç”Ÿæˆ Vue 3 é¡¹ç›®ä¸­çš„è·¯ç”±é…ç½®]]></title>
        <id>https://ihopefulchina.github.io/ZxMrztTo35/</id>
        <link href="https://ihopefulchina.github.io/ZxMrztTo35/">
        </link>
        <updated>2024-07-17T08:50:37.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨å¼€å‘å¤§å‹åº”ç”¨æ—¶ï¼Œæ‰‹åŠ¨ç®¡ç†è·¯ç”±é…ç½®æ–‡ä»¶å¯èƒ½ä¼šéå¸¸ç¹çä¸”å®¹æ˜“å‡ºé”™ã€‚ç‰¹åˆ«æ˜¯åœ¨å¤šé¡µé¢åº”ç”¨æˆ–ä½¿ç”¨åˆ†åŒ…çš„é¡¹ç›®ä¸­ï¼Œé¡µé¢å’Œè·¯ç”±è·¯å¾„å¯èƒ½ä¼šä¸æ–­å¢åŠ æˆ–å˜åŒ–ã€‚å¦‚æœæ¯æ¬¡éƒ½æ‰‹åŠ¨æ›´æ–°è·¯ç”±é…ç½®æ–‡ä»¶ï¼Œå¼€å‘æ•ˆç‡å°†ä¼šå¤§å¤§é™ä½ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨å¼€å‘å¤§å‹åº”ç”¨æ—¶ï¼Œæ‰‹åŠ¨ç®¡ç†è·¯ç”±é…ç½®æ–‡ä»¶å¯èƒ½ä¼šéå¸¸ç¹çä¸”å®¹æ˜“å‡ºé”™ã€‚ç‰¹åˆ«æ˜¯åœ¨å¤šé¡µé¢åº”ç”¨æˆ–ä½¿ç”¨åˆ†åŒ…çš„é¡¹ç›®ä¸­ï¼Œé¡µé¢å’Œè·¯ç”±è·¯å¾„å¯èƒ½ä¼šä¸æ–­å¢åŠ æˆ–å˜åŒ–ã€‚å¦‚æœæ¯æ¬¡éƒ½æ‰‹åŠ¨æ›´æ–°è·¯ç”±é…ç½®æ–‡ä»¶ï¼Œå¼€å‘æ•ˆç‡å°†ä¼šå¤§å¤§é™ä½ã€‚</p>
<!-- more -->
<p>æˆ‘å†™äº†ä¸€ä¸ªå¦‚ä½•é€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬ç”Ÿæˆ Vue 3 é¡¹ç›®çš„è·¯ç”±é…ç½®æ–‡ä»¶ã€‚å…·ä½“æ¥è¯´ï¼Œå°†æ ¹æ® pages.json æ–‡ä»¶åŠ¨æ€ç”Ÿæˆè·¯ç”±æ˜ å°„ï¼Œå¹¶ä¸”æ”¯æŒåˆ†åŒ…å’Œ tabBar é…ç½®ã€‚</p>
<h3 id="èƒŒæ™¯">èƒŒæ™¯</h3>
<p>åœ¨æŸäº›å°ç¨‹åºæ¡†æ¶ï¼ˆå¦‚ Taro æˆ– WeChat å°ç¨‹åºï¼‰ä¸­ï¼Œè·¯ç”±é…ç½®æ˜¯é€šè¿‡ pages.json æ–‡ä»¶æ¥ç»´æŠ¤çš„ã€‚è¿™ä¸ªæ–‡ä»¶å®šä¹‰äº†é¡µé¢çš„è·¯å¾„ã€tabBar é…ç½®ã€åˆ†åŒ…ç­‰ä¿¡æ¯ã€‚ä¸ºäº†æé«˜å¼€å‘æ•ˆç‡ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿè‡ªåŠ¨ä» pages.json æ–‡ä»¶ä¸­è¯»å–è¿™äº›ä¿¡æ¯ï¼Œå¹¶ç”Ÿæˆå¯¹åº”çš„è·¯ç”±é…ç½®æ–‡ä»¶ï¼Œè€Œä¸éœ€è¦æ‰‹åŠ¨å»ç¼–å†™ã€‚</p>
<h3 id="å®ç°æ€è·¯">å®ç°æ€è·¯</h3>
<p>æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ª Node.js è„šæœ¬ï¼Œå®ƒä¼šï¼š<br>
1.	è¯»å– pages.json æ–‡ä»¶ã€‚<br>
2.	æå–ä¸»åŒ…å’Œåˆ†åŒ…çš„é¡µé¢è·¯ç”±ä¿¡æ¯ã€‚<br>
3.	ç”Ÿæˆç¬¦åˆ Vue 3 é¡¹ç›®è·¯ç”±è¦æ±‚çš„é…ç½®ã€‚<br>
4.	è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª TypeScript æ–‡ä»¶æ¥ä¿å­˜è·¯ç”±æ˜ å°„ã€‚</p>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<p>æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹è„šæœ¬å®ç°è‡ªåŠ¨ç”Ÿæˆè·¯ç”±é…ç½®çš„åŠŸèƒ½ï¼š</p>
<pre><code>
/* eslint-disable id-length */
/* eslint-disable @typescript-eslint/no-var-requires */
const fs = require('fs');
const pagesJson = require('../src/pages.json');

const tabBar = (pagesJson?.tabBar ?? [])?.list.map((item) =&gt; ({ url: `/${item.pagePath}` }));

const mainPages = pagesJson?.pages?.map((it) =&gt; ({ name: it.name || '', path: it.path }));

const subPackages = [];
/** è·å–åˆ†åŒ…çš„è·¯ç”± */
pagesJson?.subPackages
    ?.map((it) =&gt; {
        if (it.pages) {
            return it.pages.map((vl) =&gt; ({ name: vl.name || '', path: it.root + '/' + vl.path }));
        }
    })
    ?.map((it) =&gt; {
        if (it) {
            subPackages.push(...it);
        }
    });
const pages = [...mainPages, ...subPackages]; // æ‰€æœ‰è·¯ç”±

const tab = '  ';
let str = `
/**
 * é¡µé¢è·¯ç”±æ˜ å°„.
 * è¯·ä¸è¦åœ¨æ­¤æ–‡ä»¶æ·»åŠ ä»»ä½•ä»£ç ã€‚å› ä¸ºç”Ÿæˆåä¼šå…¨é‡è¦†ç›–
 * è¿è¡Œ npm run route æˆ–è€… yarn route è‡ªåŠ¨ç”Ÿæˆ
 */

export const routeNames = {\n`;

str += pages
    .map(({ name, path }, index) =&gt; {
        const key = path.replace(/^\//, '').replace(/\/([a-zA-Z0-9])/g, (_m, p) =&gt; p.toUpperCase());
        return `${tab}${tab}/** ${name} */\n${tab}${tab}${key}: '/${path}'${index !== pages.length - 1 ? ',' : ''}`;
    })
    .join('\n');

str += '\n};\n\n';

if (tabBar.length) {
    str +=
        'export const tabbar = ' +
        JSON.stringify(tabBar, undefined, 4)
            .replace(/&quot;(.+)&quot;:/g, '$1:')
            .replace(/: &quot;(.+)&quot;/g, &quot;:'$1'&quot;);
    str += ';\n\n';
}

fs.writeFile('./src/routes.ts', str, (error) =&gt; {
    // åˆ›å»ºå¤±è´¥
    if (error) {
        console.log(`ç”Ÿæˆå¤±è´¥âŒï¼š${error}`);
    }
    // åˆ›å»ºæˆåŠŸ
    console.log('ğŸ‰ğŸ‰ğŸ‰ğŸ‰è·¯ç”±ç”Ÿæˆâœ…');
});

</code></pre>
<h3 id="å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨</h3>
<ol>
<li>å°†ä¸Šè¿°è„šæœ¬æ–‡ä»¶ä¿å­˜ä¸º generate-routes.jsï¼Œå¹¶æ”¾ç½®åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸­ã€‚</li>
<li>åœ¨ package.json ä¸­æ·»åŠ ä¸€ä¸ªè„šæœ¬å‘½ä»¤æ¥æ‰§è¡Œè¿™ä¸ªè„šæœ¬ï¼š</li>
</ol>
<pre><code>       &quot;scripts&quot;: {
       &quot;route&quot;: &quot;node generate-routes.js&quot;
       }
</code></pre>
<ol start="3">
<li>è¿è¡Œå‘½ä»¤ç”Ÿæˆè·¯ç”±é…ç½®ï¼š<br>
<code>        npm run route    </code></li>
</ol>
<h3 id="æ€»ç»“">æ€»ç»“</h3>
<p>é€šè¿‡è¿™ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬ï¼Œæˆ‘ä»¬èƒ½å¤Ÿè½»æ¾åœ°æ ¹æ® pages.json æ–‡ä»¶ç”Ÿæˆé¡¹ç›®ä¸­çš„è·¯ç”±é…ç½®ã€‚è¿™å¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡ï¼Œé¿å…äº†æ‰‹åŠ¨ç»´æŠ¤è·¯ç”±çš„ç¹çå·¥ä½œã€‚æ¯å½“ pages.json æ–‡ä»¶æ›´æ–°æ—¶ï¼Œæˆ‘ä»¬åªéœ€é‡æ–°è¿è¡Œè„šæœ¬ï¼Œè·¯ç”±é…ç½®å°±ä¼šè‡ªåŠ¨æ›´æ–°ã€‚<br>
<img src="https://ihopefulchina.github.io/post-images/1739757236685.png" alt="" loading="lazy"></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ğŸ™‹ğŸ™‹ğŸ™‹AvatarCropper: å¤´åƒè£å‰ªç»„ä»¶]]></title>
        <id>https://ihopefulchina.github.io/7dtD7wCIDd/</id>
        <link href="https://ihopefulchina.github.io/7dtD7wCIDd/">
        </link>
        <updated>2024-07-09T06:51:15.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¦‚ä½•å®ç°ä¸€ä¸ªå¤´åƒè£å‰ªç»„ä»¶ (AvatarCropper)ï¼Œå®ƒä¸ä»…å¯ä»¥è£å‰ªå›¾ç‰‡ï¼Œè¿˜èƒ½å¤„ç†ç¼©æ”¾ã€æ—‹è½¬ç­‰æ“ä½œã€‚è¯¥ç»„ä»¶åŸºäº Taro æ¡†æ¶æ„å»ºï¼Œå¯ä»¥åœ¨å¤šç§ç¯å¢ƒä¸­è¿è¡Œï¼ˆå¦‚å¾®ä¿¡ã€æ”¯ä»˜å®å°ç¨‹åºå’ŒWebï¼‰ã€‚æˆ‘ä»¬å°†åˆ†æå…¶æ ¸å¿ƒåŠŸèƒ½ï¼Œç»“æ„ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨å¦‚ä½•å®ç°ä¸€ä¸ªå¤´åƒè£å‰ªç»„ä»¶ (AvatarCropper)ï¼Œå®ƒä¸ä»…å¯ä»¥è£å‰ªå›¾ç‰‡ï¼Œè¿˜èƒ½å¤„ç†ç¼©æ”¾ã€æ—‹è½¬ç­‰æ“ä½œã€‚è¯¥ç»„ä»¶åŸºäº Taro æ¡†æ¶æ„å»ºï¼Œå¯ä»¥åœ¨å¤šç§ç¯å¢ƒä¸­è¿è¡Œï¼ˆå¦‚å¾®ä¿¡ã€æ”¯ä»˜å®å°ç¨‹åºå’ŒWebï¼‰ã€‚æˆ‘ä»¬å°†åˆ†æå…¶æ ¸å¿ƒåŠŸèƒ½ï¼Œç»“æ„ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒã€‚</p>
<!-- more -->
<h3 id="ç»„ä»¶æ¦‚è¿°">ç»„ä»¶æ¦‚è¿°</h3>
<p>AvatarCropper æ˜¯ä¸€ä¸ªç”¨æˆ·è‡ªå®šä¹‰çš„å¤´åƒè£å‰ªå·¥å…·ï¼Œå…è®¸ç”¨æˆ·é€‰æ‹©å›¾ç‰‡è¿›è¡Œè£å‰ªï¼Œæ”¯æŒç¼©æ”¾ã€æ—‹è½¬ã€æ‹–åŠ¨ç­‰æ“ä½œã€‚ç»„ä»¶çš„åŠŸèƒ½åŒ…æ‹¬ï¼š<br>
â€¢	é€‰æ‹©å›¾ç‰‡è¿›è¡Œè£å‰ªã€‚<br>
â€¢	æ”¯æŒç¼©æ”¾å’Œæ—‹è½¬å›¾åƒã€‚<br>
â€¢	åœ¨ç”»å¸ƒä¸Šå®æ—¶æ˜¾ç¤ºè£å‰ªæ•ˆæœã€‚<br>
â€¢	è£å‰ªå®Œæˆåï¼Œå¯ä»¥è¿”å›è£å‰ªåçš„å›¾ç‰‡æˆ–æ–‡ä»¶è·¯å¾„ã€‚</p>
<h3 id="ç»„ä»¶å±æ€§è§£æ">ç»„ä»¶å±æ€§è§£æ</h3>
<p>AvatarCropper çš„ä¸€äº›å¸¸è§å±æ€§ï¼š<br>
â€¢	maxZoomï¼šæœ€å¤§ç¼©æ”¾å€æ•°ï¼Œæ§åˆ¶è£å‰ªåŒºåŸŸçš„æœ€å¤§ç¼©æ”¾ç¨‹åº¦ã€‚<br>
â€¢	spaceï¼šè£å‰ªæ¡†ä¸ç”»å¸ƒè¾¹ç¼˜çš„ç©ºéš™ï¼Œé¿å…è£å‰ªæ¡†è¢«ç”»å¸ƒè¾¹ç•Œé™åˆ¶ã€‚<br>
â€¢	toolbarï¼šè£å‰ªå·¥å…·æ çš„å†…å®¹ï¼Œå¯ä»¥è‡ªå®šä¹‰æ˜¾ç¤ºçš„æŒ‰é’®ã€‚<br>
â€¢	toolbarPositionï¼šå·¥å…·æ çš„ä½ç½®ï¼Œæ”¯æŒ top æˆ– bottomã€‚<br>
â€¢	editTextï¼šæ˜¾ç¤ºåœ¨è£å‰ªå·¥å…·æ çš„ç¼–è¾‘æ–‡å­—ã€‚<br>
â€¢	sizeType å’Œ sourceTypeï¼šå…è®¸é€‰æ‹©å›¾ç‰‡çš„ç±»å‹å’Œæ¥æºã€‚<br>
â€¢	shapeï¼šè£å‰ªæ¡†çš„å½¢çŠ¶ï¼Œæ”¯æŒ square æˆ– roundã€‚<br>
â€¢	onConfirmï¼šè£å‰ªå®Œæˆåçš„å›è°ƒå‡½æ•°ï¼Œä¼ é€’è£å‰ªåçš„å›¾ç‰‡è·¯å¾„ã€‚<br>
â€¢	onCancelï¼šå–æ¶ˆè£å‰ªçš„å›è°ƒå‡½æ•°ã€‚</p>
<h3 id="ä»£ç ">ä»£ç </h3>
<p>index.less code</p>
<pre><code>.avatar-cropper {
  position: relative;
  display: flex;

  &amp;-edit-text {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #000;
    z-index: 1;
    color: #fff;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  &amp;-input {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0; // éšè—åŸç”Ÿä¸Šä¼ æŒ‰é’®
    cursor: pointer;
    z-index: 2;
  }

  &amp;-popup {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #000;
    z-index: 1000;
    &amp;-canvas,
    &amp;-cut-canvas {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
    }

    &amp;-cut-canvas {
      z-index: 0;
    }

    &amp;-toolbar {
      position: absolute;
      bottom: 30px;
      left: 0;
      width: 100%;
      z-index: 2;

      &amp;.top {
        top: 0;
        bottom: inherit;
      }

      &amp;-flex {
        width: 100%;
        display: flex;
        justify-content: space-between;
      }

      &amp;-item {
        // flex: 1;
        color: #fff;
        padding: 10px 30px;
        cursor: pointer;
        display: flex;
        align-items: center;
      }
    }

    &amp;-highlight {
      position: absolute;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      z-index: 1;
      background-color: transparent;

      .highlight {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        background-color: transparent;
        // box-shadow: 0 0 1000px 1000px rgba(0, 0, 0, 0.6);
      }
    }
  }

  &amp;.round {
    .nut-avatar-cropper-edit-text {
      border-radius: 50%;
    }
  }
}

[dir='rtl'] .avatar-cropper,
.nut-rtl .avatar-cropper {
  &amp;-edit-text {
    left: auto;
    right: 0;
  }

  &amp;-input {
    left: auto;
    right: 0;
  }

  &amp;-popup {
    left: auto;
    right: 0;

    &amp;-canvas,
    &amp;-cut-canvas {
      left: auto;
      right: 0;
    }

    &amp;-toolbar {
      left: auto;
      right: 0;
    }

    &amp;-highlight {
      left: auto;
      right: 0;

      .highlight {
        left: auto;
        right: 50%;
        transform: translate(50%, -50%);
      }
    }
  }
}

.canvans-btn {
  font-size: 13px;
  color: #fff;
  font-weight: 400;
  display: flex;
  justify-content: center;
  align-items: center;
  cursor: pointer;
}
</code></pre>
<p>index.tsx code</p>
<pre><code>import { AvatarCropper } from './avatarcropper'

export type {
  AvatarCropperProps,
  AvatarCropperToolbarPosition,
  AvatarCropperSizeType,
  AvatarCropperSourceType,
  AvatarCropperShape
} from './avatarcropper'
export default AvatarCropper
</code></pre>
<p>type.ts code</p>
<pre><code>import type { CSSProperties, ReactNode } from 'react'

export interface BasicComponent {
  className?: string
  style?: CSSProperties
  children?: ReactNode
  id?: string
}

export const ComponentDefaults = {
  className: '',
  style: {}
}
</code></pre>
<p>use-touch.ts code</p>
<pre><code>import React, { useRef } from 'react'

const MIN_DISTANCE = 10

type Direction = '' | 'vertical' | 'horizontal'

function getDirection(x: number, y: number) {
  if (x &gt; y &amp;&amp; x &gt; MIN_DISTANCE) {
    return 'horizontal'
  }
  if (y &gt; x &amp;&amp; y &gt; MIN_DISTANCE) {
    return 'vertical'
  }
  return ''
}

export function useTouch() {
  const startX = useRef(0)
  const startY = useRef(0)
  const deltaX = useRef(0)
  const deltaY = useRef(0)
  const delta = useRef(0)
  const offsetX = useRef(0)
  const offsetY = useRef(0)
  const direction = useRef&lt;Direction&gt;('')
  const last = useRef(false)
  const velocity = useRef(0)
  const touchTime = useRef&lt;number&gt;(Date.now())

  const isVertical = () =&gt; direction.current === 'vertical'
  const isHorizontal = () =&gt; direction.current === 'horizontal'

  const reset = () =&gt; {
    touchTime.current = Date.now()
    deltaX.current = 0
    deltaY.current = 0
    offsetX.current = 0
    offsetY.current = 0
    delta.current = 0
    direction.current = ''
    last.current = false
  }

  const start = (event: React.TouchEvent&lt;HTMLElement&gt;) =&gt; {
    reset()
    touchTime.current = Date.now()
    startX.current = event.touches[0].clientX
    startY.current = event.touches[0].clientY
  }

  const move = (event: React.TouchEvent&lt;HTMLElement&gt;) =&gt; {
    const touch = event.touches[0]
    // Fix: Safari back will set clientX to negative number
    deltaX.current = touch.clientX &lt; 0 ? 0 : touch.clientX - startX.current
    deltaY.current = touch.clientY - startY.current
    offsetX.current = Math.abs(deltaX.current)
    offsetY.current = Math.abs(deltaY.current)
    delta.current = isVertical() ? deltaY.current : deltaX.current

    if (!direction.current) {
      direction.current = getDirection(offsetX.current, offsetY.current)
    }
  }
  const end = (event: React.TouchEvent&lt;HTMLElement&gt;) =&gt; {
    last.current = true
    velocity.current = Math.sqrt(deltaX.current ** 2 + deltaY.current ** 2) / (Date.now() - touchTime.current)
  }

  return {
    end,
    move,
    start,
    reset,
    touchTime,
    startX,
    startY,
    deltaX,
    deltaY,
    delta,
    offsetX,
    offsetY,
    direction,
    isVertical,
    isHorizontal,
    last
  }
}
</code></pre>
<p>utils.ts code</p>
<pre><code>export const isObject = (val: unknown): val is Record&lt;any, any&gt; =&gt; val !== null &amp;&amp; typeof val === 'object'

// eslint-disable-next-line @typescript-eslint/ban-types
export const isFunction = (val: unknown): val is Function =&gt; typeof val === 'function'

export const isPromise = &lt;T = any&gt;(val: unknown): val is Promise&lt;T&gt; =&gt; {
  return isObject(val) &amp;&amp; isFunction(val.then) &amp;&amp; isFunction(val.catch)
}

export const upperCaseFirst = (str: string) =&gt; {
  str = str.toLowerCase()
  str = str.replace(/\b\w+\b/g, (word) =&gt; word.substring(0, 1).toUpperCase() + word.substring(1))
  return str
}

export const clamp = (num: number, min: number, max: number): number =&gt; Math.min(Math.max(num, min), max)

export function preventDefault(event: React.TouchEvent&lt;HTMLElement&gt; | TouchEvent, isStopPropagation?: boolean) {
  if (typeof event.cancelable !== 'boolean' || event.cancelable) {
    event.preventDefault()
  }

  if (isStopPropagation) {
    event.stopPropagation()
  }
}
</code></pre>
<h3 id="ç®€å•å®ä¾‹">ç®€å•å®ä¾‹</h3>
<pre><code>&lt;AvatarCropper shape=&quot;round&quot; onConfirm={cutImage}&gt;
        &lt;View className={styles.headImgCenter}&gt;
          {!!headImg &amp;&amp; &lt;Image className={styles.headImg} src={headImg ?? ''} mode=&quot;aspectFill&quot; /&gt;}
        &lt;/View&gt;
      &lt;/AvatarCropper&gt;
</code></pre>
<h3 id="todo">TODO</h3>
<p>ç›¸å…³æ ¸å¿ƒé€»è¾‘</p>
<figure data-type="image" tabindex="1"><img src="https://ihopefulchina.github.io/post-images/1739775430071.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è‡ªå®šä¹‰Hooks: useRouterParams(Web) - è·å– URL ä¸­çš„æŸ¥è¯¢å‚æ•°]]></title>
        <id>https://ihopefulchina.github.io/p9E7d0w867/</id>
        <link href="https://ihopefulchina.github.io/p9E7d0w867/">
        </link>
        <updated>2024-06-12T06:36:43.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨ React ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦è·å–å’Œå¤„ç† URL ä¸­çš„æŸ¥è¯¢å‚æ•°ã€‚ç‰¹åˆ«æ˜¯åœ¨å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ä¸­ï¼Œè·¯ç”±å‚æ•°çš„ç®¡ç†å’Œè½¬æ¢éå¸¸å¸¸è§ã€‚ä¸ºäº†æé«˜ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ React çš„ Hook æ¥å°è£…è¿™ç±»é€»è¾‘ï¼Œç¡®ä¿ä»£ç ç®€æ´ã€æ˜“äºç»´æŠ¤ã€‚é€šè¿‡å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ useRouterParams Hook æ¥æ¼”ç¤ºå¦‚ä½•è·å– URL ä¸­çš„æŸ¥è¯¢å‚æ•°ï¼Œå¹¶æ ¹æ®éœ€æ±‚è¿›è¡Œè§£æå’Œè½¬æ¢ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨ React ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦è·å–å’Œå¤„ç† URL ä¸­çš„æŸ¥è¯¢å‚æ•°ã€‚ç‰¹åˆ«æ˜¯åœ¨å•é¡µåº”ç”¨ï¼ˆSPAï¼‰ä¸­ï¼Œè·¯ç”±å‚æ•°çš„ç®¡ç†å’Œè½¬æ¢éå¸¸å¸¸è§ã€‚ä¸ºäº†æé«˜ä»£ç çš„å¤ç”¨æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ React çš„ Hook æ¥å°è£…è¿™ç±»é€»è¾‘ï¼Œç¡®ä¿ä»£ç ç®€æ´ã€æ˜“äºç»´æŠ¤ã€‚é€šè¿‡å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ useRouterParams Hook æ¥æ¼”ç¤ºå¦‚ä½•è·å– URL ä¸­çš„æŸ¥è¯¢å‚æ•°ï¼Œå¹¶æ ¹æ®éœ€æ±‚è¿›è¡Œè§£æå’Œè½¬æ¢ã€‚</p>
<!-- more -->
<h3 id="èƒŒæ™¯">èƒŒæ™¯</h3>
<p>åœ¨å‰ç«¯å¼€å‘ä¸­ï¼Œè·¯ç”±æŸ¥è¯¢å‚æ•°ï¼ˆQuery Parametersï¼‰æ˜¯éå¸¸å¸¸è§çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç”µå•†å¹³å°ä¸­ï¼Œå¯èƒ½ä¼šé€šè¿‡ URL çš„æŸ¥è¯¢å‚æ•°æ¥ä¼ é€’è¿‡æ»¤æ¡ä»¶ï¼ˆå¦‚ç±»åˆ«ã€ä»·æ ¼åŒºé—´ç­‰ï¼‰ã€‚å¯¹äºå¤šé¡µé¢åº”ç”¨ï¼ˆMPAï¼‰æˆ–å•é¡µé¢åº”ç”¨ï¼ˆSPAï¼‰ï¼Œè·å–å’Œå¤„ç†è¿™äº›å‚æ•°æ˜¯å¿…ä¸å¯å°‘çš„æ“ä½œã€‚</p>
<p>React å®˜æ–¹æä¾›çš„ useLocation å’Œ useHistory é’©å­å¯ä»¥å¸®åŠ©æˆ‘ä»¬è®¿é—®è·¯ç”±ï¼Œä½†å®ƒä»¬é»˜è®¤åªè¿”å›å®Œæ•´çš„ URL ä¿¡æ¯ï¼Œæ²¡æœ‰ç›´æ¥æä¾›å¯¹æŸ¥è¯¢å‚æ•°çš„å¤„ç†ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰ Hook æ¥ç®€åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚</p>
<h3 id="å®ç°æ€è·¯">å®ç°æ€è·¯</h3>
<p>æˆ‘ä»¬å¸Œæœ›åˆ›å»ºä¸€ä¸ª useRouterParams çš„ Hookï¼Œå®ƒå…·æœ‰ä»¥ä¸‹åŠŸèƒ½ï¼š<br>
â€¢	è·å–å½“å‰é¡µé¢çš„æŸ¥è¯¢å‚æ•°ã€‚<br>
â€¢	å¯ä»¥é€‰æ‹©å¯¹æŸ¥è¯¢å‚æ•°è¿›è¡Œè½¬æ¢ï¼ˆä¾‹å¦‚ï¼Œè½¬æ¢ä¸ºæ•°å€¼ç±»å‹æˆ–æšä¸¾ç±»å‹ï¼‰ã€‚<br>
â€¢	æä¾›ä¸€ç§ç®€ä¾¿çš„æ–¹å¼æ¥è®¿é—®å’Œç®¡ç†æŸ¥è¯¢å‚æ•°ã€‚</p>
<h3 id="ä»£ç å®ç°">ä»£ç å®ç°</h3>
<p>ä¸‹é¢æ˜¯ useRouterParams Hook çš„å®ç°ä»£ç ï¼š</p>
<pre><code>import { useMemo } from 'react'

export type DefaultParams = Partial&lt;Record&lt;string, string&gt;&gt;

/**
 * è·å–è·¯ç”±å‚æ•°ã€‚
 * è¿™ä¸ªé’©å­å…è®¸å¼€å‘è€…ç±»å‹åŒ–è·¯ç”±å‚æ•°ï¼Œå¹¶å¯é€‰åœ°æä¾›ä¸€ä¸ªè§£æå‡½æ•°æ¥å¤„ç†å‚æ•°ã€‚
 *
 * @param option.parseFn è§£æå‡½æ•°ã€‚é»˜è®¤è·¯ç”±å‚æ•°éƒ½æ˜¯stringç±»å‹ã€‚æœ‰äº›æ—¶å€™ä½ éœ€è¦è½¬æ¢æˆå…¶ä»–ç±»å‹(æ•°å€¼/æšä¸¾)ç­‰ã€‚ä½ å¯ä»¥é€šè¿‡ä¼ é€’è¿™ä¸ªå‚æ•°æ¥å¤„ç†å‚æ•°ã€‚
 *
 */
export function useRouterParams&lt;T = DefaultParams&gt;(
  option: {
    transform?: (data: T) =&gt; T
  } = {}
) {
  const url = new URL(window.location.href)

  const params = getQueryParams(url?.href) as T

  const _param = useMemo(() =&gt; {
    // è®¡ç®—key
    let cparam: T = params as T

    try {
      if (option.transform) cparam = option.transform(cparam)
    } catch (event) {
      // eslint-disable-next-line no-console
      console.error('parseFn æ‰§è¡Œå¤±è´¥:', event)
    }

    return { ...params, ...cparam } as T
  }, [params])

  return [_param as T] as const
}

// æ­£åˆ™è¡¨è¾¾å¼æå–æŸ¥è¯¢å­—ç¬¦ä¸²
function getQueryParams(url: string): Record&lt;string, string&gt; {
  const queryString = url.split('?')[1] || ''
  const params: Record&lt;string, string&gt; = {}

  // åŒ¹é…æ‰€æœ‰çš„ key=value å¯¹
  queryString.replace(/([^=&amp;]+)=([^&amp;]*)/g, (_match, key, value) =&gt; {
    params[decodeURIComponent(key)] = decodeURIComponent(value)
    return ''
  })

  return params
}

</code></pre>
<h3 id="ç®€å•å®ä¾‹">ç®€å•å®ä¾‹</h3>
<figure data-type="image" tabindex="1"><img src="https://ihopefulchina.github.io/post-images/1739774334205.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è‡ªå®šä¹‰Hooks: useLockFn(Vue3) - é˜²æ­¢é¢‘ç¹è§¦å‘å‡½æ•°è°ƒç”¨]]></title>
        <id>https://ihopefulchina.github.io/mHHMm1wDV3/</id>
        <link href="https://ihopefulchina.github.io/mHHMm1wDV3/">
        </link>
        <updated>2024-05-08T01:45:15.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œé˜²æ­¢ç”¨æˆ·å¿«é€Ÿé‡å¤ç‚¹å‡»æŒ‰é’®æˆ–æ‰§è¡ŒæŸäº›æ“ä½œæ˜¯ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·åœ¨çŸ­æ—¶é—´å†…è¿ç»­ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½åªæƒ³æ‰§è¡Œç¬¬ä¸€æ¬¡ç‚¹å‡»çš„æ“ä½œï¼Œè€Œå¿½ç•¥åç»­çš„é‡å¤ç‚¹å‡»ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª é”å®šæœºåˆ¶ æ¥é˜²æ­¢å‡½æ•°çš„å¤šæ¬¡è°ƒç”¨ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Vue 3 ä¸­çš„ ref å’Œ async å‡½æ•°æ¥å®ç°ä¸€ä¸ª useLockFn è‡ªå®šä¹‰ Hookï¼Œå®ƒå¯ä»¥é˜²æ­¢åœ¨çŸ­æ—¶é—´å†…é‡å¤æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥æ“ä½œã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨ç°ä»£å‰ç«¯å¼€å‘ä¸­ï¼Œé˜²æ­¢ç”¨æˆ·å¿«é€Ÿé‡å¤ç‚¹å‡»æŒ‰é’®æˆ–æ‰§è¡ŒæŸäº›æ“ä½œæ˜¯ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·åœ¨çŸ­æ—¶é—´å†…è¿ç»­ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½åªæƒ³æ‰§è¡Œç¬¬ä¸€æ¬¡ç‚¹å‡»çš„æ“ä½œï¼Œè€Œå¿½ç•¥åç»­çš„é‡å¤ç‚¹å‡»ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª é”å®šæœºåˆ¶ æ¥é˜²æ­¢å‡½æ•°çš„å¤šæ¬¡è°ƒç”¨ã€‚æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Vue 3 ä¸­çš„ ref å’Œ async å‡½æ•°æ¥å®ç°ä¸€ä¸ª useLockFn è‡ªå®šä¹‰ Hookï¼Œå®ƒå¯ä»¥é˜²æ­¢åœ¨çŸ­æ—¶é—´å†…é‡å¤æ‰§è¡Œä¸€ä¸ªå¼‚æ­¥æ“ä½œã€‚</p>
<!-- more -->
<h3 id="éœ€æ±‚åˆ†æ">éœ€æ±‚åˆ†æ</h3>
<p>æœ‰äº›æ“ä½œå¯èƒ½ä¼šè¢«é¢‘ç¹è§¦å‘ï¼Œæ¯”å¦‚ï¼š<br>
â€¢	ç”¨æˆ·å¤šæ¬¡ç‚¹å‡»æŒ‰é’®å‘èµ·ç½‘ç»œè¯·æ±‚ã€‚<br>
â€¢	è¿ç»­è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°å¯¼è‡´é‡å¤æ“ä½œï¼ˆä¾‹å¦‚ï¼Œè¡¨å•æäº¤ã€æ•°æ®ä¿å­˜ç­‰ï¼‰ã€‚</p>
<p>ä¸ºäº†é¿å…è¿™ç§é‡å¤æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ é”æœºåˆ¶ï¼Œç¡®ä¿åŒä¸€æ—¶åˆ»åªæ‰§è¡Œä¸€æ¬¡å‡½æ•°ã€‚</p>
<h3 id="uselockfn-çš„å®ç°">useLockFn çš„å®ç°</h3>
<p>useLockFn æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œå®ƒæ¥å—ä¸€ä¸ªå¼‚æ­¥å‡½æ•° fn å’Œä¸€ä¸ªå¯é€‰çš„å»¶è¿Ÿ delayï¼ˆé»˜è®¤ä¸º 600 æ¯«ç§’ï¼‰ã€‚å®ƒè¿”å›ä¸€ä¸ªæ–°å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šï¼š<br>
â€¢	é˜²æ­¢åœ¨æŒ‡å®šçš„å»¶è¿Ÿæ—¶é—´å†…é‡å¤è°ƒç”¨ã€‚<br>
â€¢	åœ¨å¼‚æ­¥æ“ä½œå®Œæˆå‰ï¼Œé”ä½è¯¥å‡½æ•°ï¼Œé¿å…é‡å¤æ‰§è¡Œã€‚</p>
<pre><code>import { ref } from 'vue';

type ArgsAny = any[];

type Fn = (...args: ArgsAny) =&gt; Promise&lt;any&gt;;

export const useLockFn = (fn: Fn, delay = 600) =&gt; {
    const lock = ref(false);
    const lastDate = ref();

    return async (...args: ArgsAny) =&gt; {
        if (lock.value) return;
        const nowDate = new Date();

        if (lastDate?.value &amp;&amp; nowDate.getTime() - lastDate?.value.getTime() &lt;= delay) {
            return;
        }
        lastDate.value = nowDate;

        lock.value = true;
        try {
            const ret = await fn(...args);
            lock.value = false;
            return ret;
        } catch (error) {
            lock.value = false;
            throw error;
        }
    };
};
</code></pre>
<figure data-type="image" tabindex="1"><img src="https://ihopefulchina.github.io/post-images/1739756837494.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[è‡ªå®šä¹‰Hooks: useRowSelection - ProTable é€‰æ‹©é¡¹é…ç½®hooks]]></title>
        <id>https://ihopefulchina.github.io/KIr9bupcA9/</id>
        <link href="https://ihopefulchina.github.io/KIr9bupcA9/">
        </link>
        <updated>2024-04-01T01:21:53.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨å†™åŸºäºAntd Pro åå°ä¸šåŠ¡çš„æ—¶å€™ï¼Œå‘ç°ä¸€ä¸ªé«˜é¢‘ä¸šåŠ¡åœºæ™¯éœ€æ±‚ï¼š<br>
è¡¨æ ¼åˆ—è¡¨å¤šé€‰itemçš„æ—¶å€™ï¼Œæ²¡åŠæ³•è·¨åˆ†é¡µé€‰æ‹©ã€‚</p>
<p>æˆ‘å†™ä¸€ä¸ªè‡ªå®šä¹‰Hooksï¼Œæ”¯æŒè·¨åˆ†é¡µé€‰æ‹©ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨å†™åŸºäºAntd Pro åå°ä¸šåŠ¡çš„æ—¶å€™ï¼Œå‘ç°ä¸€ä¸ªé«˜é¢‘ä¸šåŠ¡åœºæ™¯éœ€æ±‚ï¼š<br>
è¡¨æ ¼åˆ—è¡¨å¤šé€‰itemçš„æ—¶å€™ï¼Œæ²¡åŠæ³•è·¨åˆ†é¡µé€‰æ‹©ã€‚</p>
<p>æˆ‘å†™ä¸€ä¸ªè‡ªå®šä¹‰Hooksï¼Œæ”¯æŒè·¨åˆ†é¡µé€‰æ‹©ã€‚</p>
<!-- more -->
<pre><code>import { TableProps } from 'antd'
import { useState } from 'react'

export interface UseRowSelectionResult&lt;T&gt; {
  /** key */
  rowKey: string
  /** é€‰æ‹©é¡¹é…ç½® */
  rowSelection?:
    | (TableProps&lt;T&gt;['rowSelection'] &amp; {
        alwaysShowAlert?: boolean
      })
    | false
  /** é€‰æ‹©é¡¹é€‰ä¸­idåˆé›† */
  selectedRowKeys: number[]
  /** æ‰¹é‡é€‰æ‹©items */
  selectedRows: T[]
  /** é€‰æ‹©é¡¹æ›´æ–° */
  setSelectedRows: (list: T[]) =&gt; void
}

export interface UseRowSelectionParams&lt;T&gt; {
  /**  @name é€‰æ‹©é¡¹Keyå€¼ */
  rowKey?: string
  /** @name é€‰æ‹©é¡¹é…ç½® */
  rowSelection?: TableProps&lt;T&gt;['rowSelection']
  /** é€‰ä¸­é¡¹æ›´æ–° */
  onChange?: (list: T[], ids: number[]) =&gt; void
}
/** hooks - ProTable é€‰æ‹©é¡¹é…ç½®hooks */
export function useRowSelection&lt;T&gt;(props?: UseRowSelectionParams&lt;T&gt;): UseRowSelectionResult&lt;T&gt; {
  const rowKey = props?.rowKey ?? 'id'

  const rowSelection = props?.rowSelection

  /** æ‰¹é‡é€‰æ‹©items */
  const [selectedRows, setSelectedRows] = useState&lt;T[]&gt;([])

  /** é€‰æ‹©é¡¹é€‰ä¸­idåˆé›† */
  const selectedRowKeys = (selectedRows || []).map((row) =&gt; row[rowKey])

  /** é€‰æ‹©é¡¹é…ç½® */
  const newRowSelection = {
    ...rowSelection,
    type: rowSelection?.type ?? 'checkbox',
    selectedRowKeys,

    onSelect: (item: any, blo) =&gt; {
      if (blo) {
        if (rowSelection?.type === 'radio') {
          setSelectedRows([{ ...item }])
        } else {
          setSelectedRows([...selectedRows, { ...item }])
        }
      } else {
        setSelectedRows(selectedRows.filter((row) =&gt; row[rowKey] !== item?.[rowKey]))
      }
    },
    onSelectAll: (blo, rows, changeRows) =&gt; {
      if (blo) {
        setSelectedRows([...selectedRows, ...changeRows])
      } else {
        if (selectedRows?.length) {
          const newList = selectedRows?.filter((item) =&gt; !changeRows?.find((row) =&gt; row[rowKey] === item[rowKey]))
          setSelectedRows(newList)
        } else {
          setSelectedRows([])
        }
      }
    },
    onChange: (selectedRowKeys, selectedRows, info) =&gt; {
      if (info?.type === 'none') {
        setSelectedRows(selectedRows)
        props?.onChange?.(selectedRowKeys, selectedRows)
      }
    }
  }

  return {
    /** key */
    rowKey,
    /** é€‰æ‹©é¡¹é…ç½® */
    rowSelection: newRowSelection,
    /** é€‰æ‹©é¡¹é€‰ä¸­idåˆé›† */
    selectedRowKeys,
    /** æ‰¹é‡é€‰æ‹©items */
    selectedRows,
    /** é€‰æ‹©é¡¹æ›´æ–° */
    setSelectedRows
  }
}
</code></pre>
<h3 id="ä½¿ç”¨æ–¹æ³•å®ä¾‹">ä½¿ç”¨æ–¹æ³•å®ä¾‹:</h3>
<pre><code> /** ProTable é€‰æ‹©é¡¹é…ç½® */
  const { rowSelection, selectedRows, setSelectedRows } = useRowSelection&lt;MallCouponTemplateResVO&gt;({
    ...props.rowSelectionProps
  })

  &lt;ProTable  rowSelection={rowSelection} /&gt;

</code></pre>
<figure data-type="image" tabindex="1"><img src="https://ihopefulchina.github.io/post-images/1739755620925.png" alt="" loading="lazy"></figure>
]]></content>
    </entry>
</feed>